<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MinasMazar's blog ~ dev stuff</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/search.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/search.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="/"> UP </a>
 |
 <a accesskey="H" href="/"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">MinasMazar's blog ~ dev stuff</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org20528bb">Android</a>
<ul>
<li><a href="#org802d2d0">Deegoogling di Andorid ~ Linux Day Napoli 2024</a></li>
<li><a href="#org5a2f860">GrapheneOS</a></li>
</ul>
</li>
<li><a href="#orgd2f3611">ASDF</a></li>
<li><a href="#orgd1d94db">Chromium / Google Chrome</a>
<ul>
<li><a href="#org9ccd785">Troubleshooting</a></li>
</ul>
</li>
<li><a href="#org1ef517b">Crontab</a></li>
<li><a href="#orga8f0908">Digital Ocean</a></li>
<li><a href="#orgec65ab8">Docker</a>
<ul>
<li><a href="#org4353b24">Backup and port Postgres databases across images</a></li>
<li><a href="#orgc33dfe2">Disable/enable autostart of a docker container.</a></li>
<li><a href="#org8485f4e">Playing Sound in Docker Containers (here the source article)</a></li>
<li><a href="#orga2b2e8a">Rename a docker image</a></li>
<li><a href="#org19194da">Rename a docker container</a></li>
<li><a href="#orgf9f00b9">Remove unused images</a></li>
<li><a href="#orgba87059">Install Docker on Linux (APT)</a></li>
<li><a href="#org3f6a309">Installing Docker on Raspberry PI</a></li>
<li><a href="#orgcd9f5ec">Usefull links for troubleshooting</a></li>
<li><a href="#org4a5b634">Play sounds from your containers on MacOS host machine</a></li>
<li><a href="#org8cc65c7">Evelopment Environment For Elixir Phoenix With Docker And Docker Compose</a></li>
<li><a href="#orgf63b667">Dockerize Phoenix webapp (my_app)</a></li>
</ul>
</li>
<li><a href="#orgd381994">Elixir</a>
<ul>
<li><a href="#org8ad3466">Install Elixir</a></li>
<li><a href="#org5c70912">Language</a>
<ul>
<li><a href="#orgea6c056">Module ~ Compile Callbacks (<code>@before_compile</code>)</a></li>
<li><a href="#orge39509f">Macros</a></li>
</ul>
</li>
<li><a href="#orgd49f5ab">Resources</a></li>
<li><a href="#org466fbd2">Clustering Elixir applications</a></li>
<li><a href="#org96c9867">Distributed Elixir nodes</a></li>
<li><a href="#org5611313">ExUnit</a></li>
<li><a href="#orgdd6f2bb">Elixir Ecommerce platforms</a></li>
<li><a href="#orgeac26ab">GenServer template</a></li>
<li><a href="#org11d466f">DynamicSupervsior template</a></li>
<li><a href="#orgfc94dfe">example KV server</a></li>
<li><a href="#orgdb7c0b3">Persisting layer using <b>:dets</b></a></li>
<li><a href="#orge614165">Development Tools: Makefile</a></li>
<li><a href="#org4f84362">Phoenix</a>
<ul>
<li><a href="#orgdd76ed1">Installer</a></li>
<li><a href="#org9e90785">Example of app release generation and setup</a></li>
<li><a href="#org1f3c5eb">Phoenix Pubsub comms across nodes</a></li>
<li><a href="#org65b2d90">Graceful startup and shutdown for Phoenix applications</a></li>
<li><a href="#org2fdf02a">Dockerize Phoenix webapp (my<sub>app</sub>)</a></li>
</ul>
</li>
<li><a href="#org2384c54">Ecto</a></li>
<li><a href="#org2da3573">Inspecting data</a></li>
<li><a href="#org6c9902d">Phoenix Livebooks</a>
<ul>
<li><a href="#org19e2adc">Livebook Cluster</a></li>
</ul>
</li>
<li><a href="#orgcd82e2b">Dockerize</a>
<ul>
<li><a href="#orgb6ce61e">Example Dockerfile for Elixir app</a></li>
<li><a href="#orgf823646">Docker compose</a></li>
</ul>
</li>
<li><a href="#orgb885b78">Mocking (a blogpost from Jos√© Valim)</a></li>
<li><a href="#orge8c848a">Scale serverless with FLAME!</a></li>
<li><a href="#orgdab52c4">Nerves</a>
<ul>
<li><a href="#org0fb0f99">Resources</a></li>
<li><a href="#org4d97a3e">Nerves + Livebook</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd4db2dc">Embedded devices</a>
<ul>
<li><a href="#orgd3087f6">Raspberry</a></li>
<li><a href="#orgf27a040">GRiSP - the Power of Erlang &amp; Elixir Embedded Systems</a></li>
</ul>
</li>
<li><a href="#org7fefed4">FFmpeg</a>
<ul>
<li><a href="#org012c017">Extract audio from video</a></li>
<li><a href="#orgb97832d">Extract frames</a></li>
<li><a href="#orgc12386b">Get an image from a webcam using V4L (video for Linux)</a></li>
<li><a href="#org9860ecd">Cut audio/videos starting from 10s from the beginning for 20s.</a></li>
<li><a href="#orgc33a834">Adjust volume</a></li>
<li><a href="#orga5179c0">Fade in/out</a></li>
<li><a href="#orgd4fff4c">Speeding up/slowing down video:</a></li>
<li><a href="#org33c0cdc">Concat audio/videos starting from a list of files</a></li>
<li><a href="#org17ce2f2">Scene detection</a></li>
<li><a href="#org05c74e5">Change sample rate</a></li>
<li><a href="#orge7bed55">Edit ID3 Tags</a></li>
<li><a href="#orgbf22171">Capture audio</a></li>
</ul>
</li>
<li><a href="#org6d72bf5">Git</a></li>
<li><a href="#org7e84fa6">Google Chrome &amp; chromedriver</a></li>
<li><a href="#orgbcbfb9e">GNU Guix</a></li>
<li><a href="#org9702aa2">GPG and SSH</a>
<ul>
<li><a href="#org289e022">Generate key</a></li>
<li><a href="#org6c382f7">List the key</a></li>
<li><a href="#org2ee82a0">Get the armored key text</a></li>
<li><a href="#org81cb160">Upload to Github</a></li>
<li><a href="#org9152cfa">Tell Git to use GPG key</a></li>
<li><a href="#orgc46b480">Export key pair</a>
<ul>
<li><a href="#org2b05e59">Export Public Key</a></li>
<li><a href="#org6d1e659">Export Secret Key</a></li>
<li><a href="#orge5e00d4">Security Concerns, Backup, and Storage</a></li>
</ul>
</li>
<li><a href="#orgc01f9fa">Import a key</a></li>
<li><a href="#org2dba61d">Troubleshooting</a></li>
<li><a href="#org53ebfc1">Generate SSH keys</a></li>
<li><a href="#org1837105">GPG Agent: cache and timeouts</a></li>
</ul>
</li>
<li><a href="#org61808a4">How to set environment variables from .env file</a></li>
<li><a href="#org4083e12">HTML &amp; CSS</a></li>
<li><a href="#org2923b75">Imagemagick</a>
<ul>
<li><a href="#orga64d697">Compare two images</a></li>
<li><a href="#orgac91af9">Resize image</a></li>
<li><a href="#orgd0dbe22">Annotating image</a></li>
<li><a href="#orgd04c735">Set an image as wallpaper</a></li>
</ul>
</li>
<li><a href="#org028a244">Javascript</a></li>
<li><a href="#orgd6e842c">Linux</a>
<ul>
<li><a href="#org1eac6b7">Brief list of useful commands, examples, snippets</a></li>
<li><a href="#orga225570">Set keyboard layout</a></li>
<li><a href="#org5b078c7">Show preferred applications (alternatives)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="debian">debian</span></span></a></li>
<li><a href="#org4f92d32">Change the ownership of a input device, like a usb mouse</a></li>
<li><a href="#orga72b31b">Opena a remote desktop session on a PCDuino</a></li>
<li><a href="#org77184ae">How do I get a list of installed files from a package?</a></li>
<li><a href="#org7bf3e10">Add a custom window manager entry for LightDM</a></li>
<li><a href="#org7f13ef7">Audio management</a>
<ul>
<li><a href="#orgac15f7f">Alsamixer</a></li>
<li><a href="#org42ab8aa">Pulseaudio</a></li>
<li><a href="#org41e6289">PipeWire</a></li>
</ul>
</li>
<li><a href="#orgf7e2999">Create a .desktop File</a></li>
<li><a href="#orgce9b0ab">Handling screen saver / blank screen</a></li>
<li><a href="#org13859cc">Read battery status from command-line</a></li>
<li><a href="#org451fa0b">iptables</a></li>
<li><a href="#org0498bdb">Screen managing</a>
<ul>
<li><a href="#org7c0aedc">X11 / xrandr</a></li>
<li><a href="#orga39a7d3">Wayland / wlr-randr</a></li>
</ul>
</li>
<li><a href="#org98e8517">Set wallpaper</a></li>
<li><a href="#org297e74c">Set keyboard layout from command-line</a></li>
<li><a href="#org46c8b71">Get and set name/class to an X application (window)</a></li>
<li><a href="#org857e043">Window Manager</a>
<ul>
<li><a href="#org17bf5da">i3wm</a></li>
<li><a href="#orga13497c">Awesome WM</a></li>
</ul>
</li>
<li><a href="#org1ab6dca">MPV</a></li>
</ul>
</li>
<li><a href="#orgdbc0fbb">MacOS</a>
<ul>
<li><a href="#orgd7f84f3">Install Homebrew</a></li>
<li><a href="#org3d69e04">Dev environment</a></li>
<li><a href="#orga5f1baf">Emacs</a></li>
<li><a href="#org7270fa1">Reset DNS cache on Macos</a></li>
<li><a href="#org530f6cd">Let QuickPlayer to autoplay on open</a></li>
<li><a href="#org7bd2fb7">Get my IP address</a></li>
<li><a href="#org54e6139">Installing Linux on MacBook Pro</a>
<ul>
<li><a href="#org4dd3ebc">Bluetooh issues</a></li>
<li><a href="#org30d050c">Sound issues</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org200b983">Makefile</a></li>
<li><a href="#org5836833">OpenSource stacks and technologies</a>
<ul>
<li><a href="#orgc733375">Push notifications</a></li>
<li><a href="#orga3bed0c">CI</a></li>
<li><a href="#orgdb43e76">Spritely institute - distributed web technology</a></li>
</ul>
</li>
<li><a href="#orgc08bb59">OpenVoiceOS&#xa0;&#xa0;&#xa0;<span class="tag"><span class="foss">foss</span>&#xa0;<span class="AI">AI</span></span></a></li>
<li><a href="#org46447e6">Pandoc</a></li>
<li><a href="#org6c996fe">Postgres</a></li>
<li><a href="#org3c3788b">Raspberry</a>
<ul>
<li><a href="#orgcd45638">Projects and Prototyping</a></li>
<li><a href="#org21f2532">Overscan</a></li>
<li><a href="#org257c01f">Detect Raspberry model</a></li>
<li><a href="#orgf57aa80">Linux based OS for Raspberry</a></li>
<li><a href="#org9200be7">Deal with I2C from CLI</a></li>
<li><a href="#org978a15d">Troubleshoot USB Capacitive Touch Screen Display</a></li>
<li><a href="#orgcb6d62c">Use Raspberry Pi in "Kiosk" mode</a>
<ul>
<li><a href="#org9f5cba5">Use Emacs as Kiosk</a></li>
<li><a href="#org642f86e">Darbula (Elixir/Phoenix)</a></li>
<li><a href="#org0fb88dd">Useful software</a></li>
<li><a href="#orgef778f8">Useful Makefile</a></li>
<li><a href="#org7177016">Browsers</a></li>
<li><a href="#orga5457ff">System setup</a></li>
<li><a href="#orgd4ffe9b">MPV + Youtube</a></li>
<li><a href="#org9255521">Simulate keyboard events</a></li>
<li><a href="#orge051aa8">Resources</a></li>
</ul>
</li>
<li><a href="#org6e6c47f">How to attach a cooler fan</a></li>
<li><a href="#orga442aec">Magic Mirror</a></li>
<li><a href="#orgb29517d">Working with USB webcams on your Raspberry Pi</a></li>
<li><a href="#org02d9175">Turn your RPi into a Spy</a></li>
<li><a href="#orgaddcf51">Turn your RPi into a Spy (audio)</a></li>
<li><a href="#org31d14f5">Turn your RPi into an Access Point</a></li>
</ul>
</li>
<li><a href="#orgce99817">Shell</a></li>
<li><a href="#org6299deb">Simple Static assets web server ~ Busybox</a></li>
<li><a href="#org806982b">Suspend the system via command line</a></li>
<li><a href="#org9684e06">Systemd</a>
<ul>
<li><a href="#org09004c1">Services definition</a></li>
<li><a href="#org5329864">Journalctl</a></li>
<li><a href="#org180faa6">Environment variables</a></li>
<li><a href="#org2de807f">Troubleshooting</a></li>
</ul>
</li>
<li><a href="#orgc0b011e">Tailwind</a></li>
<li><a href="#org6117f71">Termux</a></li>
<li><a href="#org0ed77be">Tmux</a></li>
<li><a href="#orge2dd4e3">Tor</a>
<ul>
<li><a href="#orge9a9790">Use Tor proxy via Docker</a></li>
</ul>
</li>
<li><a href="#org1549d55">Userscripts</a>
<ul>
<li><a href="#orge0989e8">How to store data on a file using Greasemonkey</a></li>
</ul>
</li>
<li><a href="#org6168650">Web browsing/crawling</a>
<ul>
<li><a href="#org7e7e5de">Get the DOM of a webpage using chrome via command-line.</a></li>
<li><a href="#org539bf5e">Fetch a page via a nodejs app</a></li>
</ul>
</li>
<li><a href="#org267ff4b">Web Resources</a></li>
<li><a href="#org1d4101f">Youtube</a>
<ul>
<li><a href="#orgc0d9659">Get the list of subscriptions (followed channels)</a></li>
<li><a href="#org46da176">Get RSS feed of a channel or playlist</a></li>
<li><a href="#org3fdb993">Youtube downloader (yt-dlp)</a>
<ul>
<li><a href="#orgc68367d">Usage examples</a></li>
<li><a href="#org04eb185">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org20528bb" class="outline-2">
<h2 id="org20528bb">Android</h2>
<div class="outline-text-2" id="text-org20528bb">
</div>
<div id="outline-container-org802d2d0" class="outline-3">
<h3 id="org802d2d0"><a href="https://dl.gianmarco.gg/presentations/linuxday24-degoogling.pdf">Deegoogling di Andorid ~ Linux Day Napoli 2024</a></h3>
</div>
<div id="outline-container-org5a2f860" class="outline-3">
<h3 id="org5a2f860"><a href="https://grapheneos.org/">GrapheneOS</a></h3>
</div>
</div>
<div id="outline-container-orgd2f3611" class="outline-2">
<h2 id="orgd2f3611"><a href="https://asdf-vm.com">ASDF</a></h2>
<div class="outline-text-2" id="text-orgd2f3611">
<p>
Choose a release here <a href="https://github.com/asdf-vm/asdf/releases">https://github.com/asdf-vm/asdf/releases</a>; add this into your <code>.bashrc</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">export PATH="${ASDF_DATA_DIR:-$HOME/.asdf}/shims:$PATH"
</pre>
</div>

<p>
This script should automate most of the procedure.
</p>

<div class="org-src-container">
<pre class="src src-sh">export asdf-tar=asdf-v0.16.7-linux-arm64.tar.gz
wget https://github.com/asdf-vm/asdf/releases/download/v0.16.7/${asdf-tar} # &lt;-- or the precompiled version you need
mkdir -p ~/.local/bin
tar -C ~/.local/bin/ -xf ${asdf-tar}
echo 'export PATH="${ASDF_DATA_DIR:-$HOME/.asdf}/shims:$PATH"' &gt;&gt; ~/.bashrc
source ~/.bashrc
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd1d94db" class="outline-2">
<h2 id="orgd1d94db">Chromium / Google Chrome</h2>
<div class="outline-text-2" id="text-orgd1d94db">
</div>
<div id="outline-container-org9ccd785" class="outline-3">
<h3 id="org9ccd785">Troubleshooting</h3>
<div class="outline-text-3" id="text-org9ccd785">
<ul class="org-ul">
<li><a href="https://github.com/puppeteer/puppeteer/issues/4860">"The profile appears to be in use by another Chromium process on another computer"</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org1ef517b" class="outline-2">
<h2 id="org1ef517b"><a href="https://it.wikipedia.org/wiki/Crontab">Crontab</a></h2>
<div class="outline-text-2" id="text-org1ef517b">
<p>
If you need to write a crontab entry you can use <a href="https://crontab.guru/">https://crontab.guru/</a>
</p>
</div>
</div>
<div id="outline-container-orga8f0908" class="outline-2">
<h2 id="orga8f0908">Digital Ocean</h2>
<div class="outline-text-2" id="text-orga8f0908">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=SSLhGanxmCg">a small tutorial about Droplets</a> (and <a href="https://www.youtube.com/watch?v=JSXsb6czs6M">this one</a>)</li>
</ul>
</div>
</div>
<div id="outline-container-orgec65ab8" class="outline-2">
<h2 id="orgec65ab8">Docker</h2>
<div class="outline-text-2" id="text-orgec65ab8">
</div>
<div id="outline-container-org4353b24" class="outline-3">
<h3 id="org4353b24">Backup and port Postgres databases across images</h3>
<div class="outline-text-3" id="text-org4353b24">
<p>
Bind to
</p>
<div class="org-src-container">
<pre class="src src-sh">docker run --rm --name postgres --volume ~/postgres-data:/var/lib/postgresql/data postgres:latest
</pre>
</div>

<p>
Backup volume with
</p>

<div class="org-src-container">
<pre class="src src-eshell">tar cf postgres-data_$(format-time-string "%N").tar postgres-data
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc33dfe2" class="outline-3">
<h3 id="orgc33dfe2">Disable/enable autostart of a docker container.</h3>
<div class="outline-text-3" id="text-orgc33dfe2">
<div class="org-src-container">
<pre class="src src-sh">docker update --restart [no|unless-stopped] &lt;docker-container&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org8485f4e" class="outline-3">
<h3 id="org8485f4e">Playing Sound in Docker Containers (<a href="https://prateeksrivastav598.medium.com/playing-sound-in-docker-containers-a-step-by-step-guide-f7a06e246a35">here the source article</a>)</h3>
<div class="outline-text-3" id="text-org8485f4e">
<div class="org-src-container">
<pre class="src src-sh">docker run --rm -it --privileged=true --device=/dev/snd:/dev/snd audio-container:v1
</pre>
</div>
</div>
</div>
<div id="outline-container-orga2b2e8a" class="outline-3">
<h3 id="orga2b2e8a">Rename a docker image</h3>
<div class="outline-text-3" id="text-orga2b2e8a">
<div class="org-src-container">
<pre class="src src-sh">docker tag OldName:tag NewName:tag
</pre>
</div>
</div>
</div>
<div id="outline-container-org19194da" class="outline-3">
<h3 id="org19194da">Rename a docker container</h3>
<div class="outline-text-3" id="text-org19194da">
<div class="org-src-container">
<pre class="src src-sh">sudo docker rename oldname_app newname_app
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf9f00b9" class="outline-3">
<h3 id="orgf9f00b9">Remove unused images</h3>
<div class="outline-text-3" id="text-orgf9f00b9">
<div class="org-src-container">
<pre class="src src-sh">docker image prune -a
</pre>
</div>

<p>
<code>docker system prune</code> will delete all dangling data (containers, networks, and images)
</p>

<p>
More info in this <a href="https://stackoverflow.com/a/32723127">StackOverflow thread</a>.
</p>
</div>
</div>
<div id="outline-container-orgba87059" class="outline-3">
<h3 id="orgba87059">Install Docker on Linux (APT)</h3>
<div class="outline-text-3" id="text-orgba87059">
<div class="org-src-container">
<pre class="src src-shell"># Add Docker's official GPG key:
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources:
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release &amp;&amp; echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
sudo apt-get update

sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</pre>
</div>

<p>
Verify that the installation is successful by running the hello-world image:
</p>

<div class="org-src-container">
<pre class="src src-shell">sudo docker run hello-world
</pre>
</div>
</div>
</div>
<div id="outline-container-org3f6a309" class="outline-3">
<h3 id="org3f6a309">Installing Docker on Raspberry PI</h3>
<div class="outline-text-3" id="text-org3f6a309">
<p>
Follow <a href="https://docs.docker.com/engine/install/raspberry-pi-os/#install-using-the-repository">the instructions in the Docker documentation</a>. Before you can install Docker Engine, you need to uninstall any conflicting packages. Distro maintainers provide an unofficial distributions of Docker packages in APT. You must uninstall these packages before you can install the official version of Docker Engine.
</p>

<div class="org-src-container">
<pre class="src src-sh">#!/bin/bash

# Uninstall unofficial distributions of Docker packages in APT

sudo apt-get purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras

# Remove images, containers, volumes, or custom configuration files 

sudo rm -rf /var/lib/docker
sudo rm -rf /var/lib/containerd

# Add Docker's official GPG key:
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/raspbian/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Set up Docker's APT repository:
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/raspbian \
  $(. /etc/os-release &amp;&amp; echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
sudo apt-get update

# Install Docker packages
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# Verify that the installation is successful by running the hello-world image:
sudo docker run hello-world
</pre>
</div>

<p>
Remember to keep the Build and App images in sync (see <a href="https://github.com/teslamate-org/teslamate/issues/3691#issuecomment-1966074893">here</a>)
</p>

<p>
When building an image, you can see an error like <i>cannot find the image for the platform&#x2026;</i>. Consider to add <code>--platform arm64</code> flag to the <code>docker build</code> command. <a href="https://docs.docker.com/reference/cli/docker/buildx/build/#platform">Here's the official Docker documentation</a> for this flag. Also keep an eye <a href="https://github.com/containerd/containerd/blob/v1.4.3/platforms/platforms.go#L63">to this file</a> to get a list of platforms. Remember you can detect the platform of the current machine via <code>uname -a</code>.
</p>

<p>
If you're using Docker to run Elixir, you can face an error like this during the dependencies compilation:
</p>

<div class="org-src-container">
<pre class="src src-sh">could not compile dependency :ssl_verify_fun, "mix compile" failed. Errors may have been logged above. You can recompile this dependency with "mix deps.compile ssl_verify_fun", update it with "mix deps.update ssl_verify_fun" or clean it with "mix deps.clean ssl_verify_fun"
</pre>
</div>

<p>
In this case, install the <code>erlang-public-key</code> package should solve the issue.
</p>


<p>
The Raspbian issue: another error that can occur while building a docker image on Raspbian that uses <code>apt-get</code> commands is
</p>

<div class="org-src-container">
<pre class="src src-sh">ERROR: failed to solve: process "/bin/sh -c apt-get update -y &amp;&amp;   apt-get install -y libstdc++6 openssl libncurses5 locales ca-certificates &amp;&amp;   apt-get clean &amp;&amp; rm -f /var/lib/apt/lists/*_*" did not complete successfully: exit code: 159
</pre>
</div>

<p>
It seems there's a problem with <a href="https://github.com/moby/moby/issues/40734">libseccomp</a>; according to <a href="https://askubuntu.com/questions/1263284/apt-update-throws-signature-error-in-ubuntu-20-04-container-on-arm">this SO thread</a> the solution is to upgrade libseccomp manually <b><b>on the host system</b></b>: download <a href="https://packages.debian.org/sid/libseccomp2">here</a> and <code>sudo dpkg -i libseccomp2_2.4.3-1+b1_armhf.deb</code>.
</p>
</div>
</div>
<div id="outline-container-orgcd9f5ec" class="outline-3">
<h3 id="orgcd9f5ec">Usefull links for troubleshooting</h3>
<div class="outline-text-3" id="text-orgcd9f5ec">
<ul class="org-ul">
<li><a href="https://github.com/teslamate-org/teslamate/issues/3691">https://github.com/teslamate-org/teslamate/issues/3691</a></li>
</ul>
</div>
</div>
<div id="outline-container-org4a5b634" class="outline-3">
<h3 id="org4a5b634">Play sounds from your containers on MacOS host machine</h3>
<div class="outline-text-3" id="text-org4a5b634">
<p>
source: <a href="https://stackoverflow.com/questions/40136606/how-to-expose-audio-from-docker-container-to-a-mac">https://stackoverflow.com/questions/40136606/how-to-expose-audio-from-docker-container-to-a-mac</a>
</p>

<p>
You need to install PulseAudio
</p>

<div class="org-src-container">
<pre class="src src-sh">brew install pulseaudio
</pre>
</div>

<p>
Start the server
</p>

<div class="org-src-container">
<pre class="src src-sh">pulseaudio --load=module-native-protocol-tcp --exit-idle-time=-1 --daemon
</pre>
</div>

<p>
In your Docker container:
</p>

<ul class="org-ul">
<li>install PulseAudio, e.g., <code>apt-get install pulseaudio</code>.</li>
<li>set the following environment variable: <code>ENV PULSE_SERVER\=host.docker.internal</code></li>
</ul>

<p>
You can run a test to see if it's working like this:
</p>

<div class="org-src-container">
<pre class="src src-sh">docker run -it -e PULSE_SERVER=host.docker.internal --mount type=bind,source=/Users/YOURUSERNAME/.config/pulse,target=/home/pulseaudio/.config/pulse --entrypoint speaker-test --rm jess/pulseaudio -c 2 -l 1 -t wav
</pre>
</div>
</div>
</div>
<div id="outline-container-org8cc65c7" class="outline-3">
<h3 id="org8cc65c7"><a href="https://dev.to/hlappa/development-environment-for-elixir-phoenix-with-docker-and-docker-compose-2g17">Evelopment Environment For Elixir Phoenix With Docker And Docker Compose</a></h3>
</div>
<div id="outline-container-orgf63b667" class="outline-3">
<h3 id="orgf63b667"><a href="#org2fdf02a">Dockerize Phoenix webapp (my<sub>app</sub>)</a></h3>
</div>
</div>
<div id="outline-container-orgd381994" class="outline-2">
<h2 id="orgd381994"><a href="https://elixir-lang.org/">Elixir</a></h2>
<div class="outline-text-2" id="text-orgd381994">
</div>
<div id="outline-container-org8ad3466" class="outline-3">
<h3 id="org8ad3466">Install Elixir</h3>
<div class="outline-text-3" id="text-org8ad3466">
<p>
<i>A Makefile tells more than a thousand words</i> üòÅ
</p>

<div class="org-src-container">
<pre class="src src-makefile">install-elixir-via-package-manager:
        sudo apt update
        sudo apt install erlang erlang-dev elixir
install-elixir-via-asdf:
        sudo apt install lincurses-dev libssl-dev
        export asdf-tar=asdf-v0.16.7-linux-arm64.tar.gz
        wget https://github.com/asdf-vm/asdf/releases/download/v0.16.7/${asdf-tar} # &lt;-- or the precompiled version you need
        mkdir -p ~/.local/bin
        tar -C ~/.local/bin/ -xf ${asdf-tar}
        echo 'export PATH="${ASDF_DATA_DIR:-$HOME/.asdf}/shims:$PATH"' &gt;&gt; ~/.bashrc
        source ~/.bashrc
        sudo apt install libncurses-dev
        asdf plugin add erlang
        asdf plugin add elixir
        asdf install erlang 27.0
        asdf install elixir 1.18.0-otp-27
        asdf reshim
</pre>
</div>

<p>
More info on ho <i>install elixir on a Raspberry PI</i> in <a href="https://erlangsolutions.medium.com/installing-elixir-on-a-raspberry-pi-the-easy-way-22f347a77e2c">this article</a>.
</p>
</div>
</div>
<div id="outline-container-org5c70912" class="outline-3">
<h3 id="org5c70912">Language</h3>
<div class="outline-text-3" id="text-org5c70912">
</div>
<div id="outline-container-orgea6c056" class="outline-4">
<h4 id="orgea6c056"><a href="https://hexdocs.pm/elixir/1.14.5/Module.html#module-compile-callbacks">Module ~ Compile Callbacks</a> (<code>@before_compile</code>)</h4>
<div class="outline-text-4" id="text-orgea6c056">
<div class="org-src-container">
<pre class="src src-elixir">defmodule A do
  defmacro __before_compile__(_env) do
    quote do
        def hello, do: "world"
    end
  end
end

defmodule B do
  @before_compile A
end

B.hello()
#=&gt; "world"
</pre>
</div>
</div>
</div>
<div id="outline-container-orge39509f" class="outline-4">
<h4 id="orge39509f">Macros</h4>
<div class="outline-text-4" id="text-orge39509f">
<ul class="org-ul">
<li><a href="https://blog.appsignal.com/2021/10/26/how-to-use-macros-in-elixir.html">How-To-Use Macros</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgd49f5ab" class="outline-3">
<h3 id="orgd49f5ab">Resources</h3>
<div class="outline-text-3" id="text-orgd49f5ab">
<ul class="org-ul">
<li><a href="https://elixir-toolbox.dev/">Toolbox</a></li>
<li><a href="https://dorgan.ar/posts/2021/04/the_elixir_ast/">Metaprogramming: The Elixir AST</a></li>
<li><a href="https://joyofelixir.com/17-mix-dependencies">Mix dependencies</a></li>
<li><a href="https://learn-elixir.dev/#hiring">Learn Elixir (learn-elixir.dev/#hiring)</a></li>
</ul>
</div>
</div>
<div id="outline-container-org466fbd2" class="outline-3">
<h3 id="org466fbd2">Clustering Elixir applications</h3>
<div class="outline-text-3" id="text-org466fbd2">
<ul class="org-ul">
<li><a href="https://betterprogramming.pub/notes-on-clustering-elixir-applications-49707ed53910">https://betterprogramming.pub/notes-on-clustering-elixir-applications-49707ed53910</a></li>
<li><a href="https://hexdocs.pm/libcluster/readme.html">https://hexdocs.pm/libcluster/readme.html</a></li>
</ul>
</div>
</div>
<div id="outline-container-org96c9867" class="outline-3">
<h3 id="org96c9867">Distributed Elixir nodes</h3>
<div class="outline-text-3" id="text-org96c9867">
<p>
Good readings about this topic:
</p>
<ul class="org-ul">
<li><a href="https://medium.com/hackernoon/running-distributed-erlang-elixir-applications-on-docker-b211d95affbe">https://medium.com/hackernoon/running-distributed-erlang-elixir-applications-on-docker-b211d95affbe</a></li>
<li><a href="https://www.erlang-solutions.com/blog/erlang-and-elixir-distribution-without-epmd/">https://www.erlang-solutions.com/blog/erlang-and-elixir-distribution-without-epmd/</a></li>
</ul>

<p>
Here's a talk I still have to watch <a href="https://www.youtube.com/watch?v=F_YUyd_Qdjs">https://www.youtube.com/watch?v=F_YUyd_Qdjs</a>
</p>
</div>
</div>
<div id="outline-container-org5611313" class="outline-3">
<h3 id="org5611313">ExUnit</h3>
<div class="outline-text-3" id="text-org5611313">
<p>
Implement the <i>before</i> and <i>after</i> callbacks:
</p>

<div class="org-src-container">
<pre class="src src-elixir">setup do
  File.write!("fixture.json", "{}")
  on_exit(fn -&gt; File.rm!("fixture.json") end)
end
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdd6f2bb" class="outline-3">
<h3 id="orgdd6f2bb">Elixir Ecommerce platforms</h3>
<div class="outline-text-3" id="text-orgdd6f2bb">
<p>
Follow this link to <a href="https://elixirforum.com/t/phoenix-frameworks-is-good-choice-for-e-commerce-web-apps/46772/3">Elixir forum post</a>.
</p>

<p>
It will probably faster and for sure will cope a lot more under load, due to the
BEAM, that is well exemplified <a href="https://video-hub.exadra37.com/watch/goto-2019-the-soul-of-erlang-and-elixir-sa%C5%A1a-juri%C4%87">here</a> by <a href="https://elixirforum.com/u/sasajuric">@sasajuric</a>.
</p>

<p>
We already have several projects in Elixir fore ecommerce:
</p>

<ul class="org-ul">
<li><a href="https://github.com/amacgregor/crimson_commerce">Crimsom</a> repo and <a href="https://dev.to/allanmacgregor/ecommerce-platform-prototype-with-elixir-and-phoenix-2d9g">article</a>.</li>
<li><a href="https://github.com/nicolasblanco/shopix">Shopix</a> repo and <a href="https://nicolasblan.co/blog/shopix-e-commerce-engine">aritcle</a>.</li>
<li><a href="https://github.com/freshcom">Freshcom</a> repos. They have separated it in several repos.</li>
<li>Many more <a href="https://github.com/search?q=elixir+ecommerce">here</a>.</li>
</ul>

<p>
I don‚Äôt really know if any of them is being/continued to be used in production. I
think Freshcom was being used in prod at some point or was about to launch.
The author is here in the forum @rbao.
</p>

<p>
If you search the forum you have more questions like yours:
</p>

<ul class="org-ul">
<li>Resources for building an e-commerce store in Phoenix?</li>
<li>Presenting Aviacommerce, open source e-commerce in Elixir</li>
</ul>
</div>
</div>
<div id="outline-container-orgeac26ab" class="outline-3">
<h3 id="orgeac26ab">GenServer template</h3>
<div class="outline-text-3" id="text-orgeac26ab">
<div class="org-src-container">
<pre class="src src-elixir">defmodule MyApp.Server do
  use GenServer

  def start_link(args) do
    GenServer.start_link(__MODULE__, args, name: Map.get(args, :name, __MODULE__))
  end

  def init(_) do
    {:ok, %{}}
  end

  def state(overrides) do
    GenServer.call(__MODULE__, :state)
  end

  def alter_state(overrides) do
    GenServer.call(__MODULE__, {:state, overrides})
  end

  def handle_call(:state, _, state), do: {:reply, state, state}
  def handle_cast({:state, overrides}, state), do: {:noreply, Map.merge(state, overrides)}
end
</pre>
</div>
</div>
</div>
<div id="outline-container-org11d466f" class="outline-3">
<h3 id="org11d466f">DynamicSupervsior template</h3>
<div class="outline-text-3" id="text-org11d466f">
<div class="org-src-container">
<pre class="src src-elixir">defmodule MySupervisor do
  use DynamicSupervisor

  def start_link(init_arg) do
    DynamicSupervisor.start_link(__MODULE__, init_arg, name: __MODULE__)
  end

  def start_child(foo, bar, baz) do
    # If MyWorker is not using the new child specs, we need to pass a map:
    # spec = %{id: MyWorker, start: {MyWorker, :start_link, [foo, bar, baz]}}
    spec = {MyWorker, foo: foo, bar: bar, baz: baz}
    DynamicSupervisor.start_child(__MODULE__, spec)
  end

  @impl true
  def init(init_arg) do
    DynamicSupervisor.init(
      strategy: :one_for_one,
      extra_arguments: [init_arg]
    )
  end
end
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfc94dfe" class="outline-3">
<h3 id="orgfc94dfe">example KV server</h3>
<div class="outline-text-3" id="text-orgfc94dfe">
<div class="org-src-container">
<pre class="src src-elixir">defmodule Darbula.KV do
  use Agent

  def start_link do
    Agent.start_link(fn -&gt; %{} end, name: __MODULE__)
  end

  def get(key) do
    Agent.get(__MODULE__, fn store -&gt; Map.get(store, key) end)
  end

  def set(key, value) do
    with :ok &lt;- Agent.update(__MODULE__, fn store -&gt; Map.put(store, key, value) end) do
      value
    end
  end

  def get_or_set(key, fun) when is_function(fun) do
    get(key) || set(key, fun.())
  end
end
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdb7c0b3" class="outline-3">
<h3 id="orgdb7c0b3">Persisting layer using <b>:dets</b></h3>
<div class="outline-text-3" id="text-orgdb7c0b3">
<ul class="org-ul">
<li><a href="https://learn-elixir.dev/blogs/avoiding-data-loss-with-elixir-dets">https://learn-elixir.dev/blogs/avoiding-data-loss-with-elixir-dets</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-elixir">defmodule MyCache do
  @table_name :my_table

  def start_link(opts \\ []) do
    Task.start_link(fn -&gt;
        {:ok, _} = :dets.open_file(opts[:table_name] || @table_name, opts)

        Process.hibernate(Function, :identity, [nil])
    end)
  end

  def get(table_name \\ @table_name, key) do
    case :dets.lookup(table_name, key) do
        [{^key, value}] -&gt; {:ok, value}
        [] -&gt; {:ok, nil}
    end
  end

  def put(table_name \\ @table_name, key, value) do
    :dets.insert(table_name, {key, value})
  end
end
</pre>
</div>
</div>
</div>
<div id="outline-container-orge614165" class="outline-3">
<h3 id="orge614165">Development Tools: Makefile</h3>
<div class="outline-text-3" id="text-orge614165">
<p>
Example Makefile for a thin elixir app.
</p>

<div class="org-src-container">
<pre class="src src-makefile">app := next

default: s
b:
        mix do deps.get, deps.compile, compile
s:
        iex -S mix
t:
        mix test
tl:
        mix test --listen-on-stdin
u:
        cat Makefile
r:
        MIX_ENV=prod mix release --path=~/${app}/
</pre>
</div>

<p>
Example Makefile for an Elixir/Phoenix webapp
</p>

<div class="org-src-container">
<pre class="src src-makefile">port := 4030
prod-env := DATABASE_URL=ecto://postgres:postgres@localhost:5432/my-app MIX_ENV=prod SECRET_KEY_BASE=8X3vyc0qkLs38OFTa4C+ZTx6Q9h0KXyfh8Ug/Yt4IUnSv8WQSzuDDe7OiR5iGwDK PHX_SERVER=true PHX_HOST=localhost PORT=${port}
cmd := $$MAKE_CMD

default: start-prod
cmd:
        echo ${cmd}
# Example usage
#
# MAKE_CMD="mix ecto.create" make -s prod-exec
#

# Start in production env
prod-exec:
        ${prod-env} ${cmd}

start-prod:
        ${prod-env} iex -S mix phx.server

# Development
build:
        mix do deps.get, deps.compile, compile
start: build
        iex -S mix phx.server
assets:
        mix assets.setup
release:
        mix deps.get --only prod
        MIX_ENV=prod mix compile
        MIX_ENV=prod mix assets.deploy
        MIX_ENV=prod PHX_SERVER=true mix release --path ~/my-app --overwrite 
release-start:
        ${prod-env} ~/my-app/bin/my-app start

</pre>
</div>
</div>
</div>
<div id="outline-container-org4f84362" class="outline-3">
<h3 id="org4f84362">Phoenix</h3>
<div class="outline-text-3" id="text-org4f84362">
</div>
<div id="outline-container-orgdd76ed1" class="outline-4">
<h4 id="orgdd76ed1">Installer</h4>
<div class="outline-text-4" id="text-orgdd76ed1">
<div class="org-src-container">
<pre class="src src-sh">mix archive.install hex phx_new
</pre>
</div>
</div>
</div>
<div id="outline-container-org9e90785" class="outline-4">
<h4 id="org9e90785">Example of app release generation and setup</h4>
<div class="outline-text-4" id="text-org9e90785">
<p>
Generate a release.
</p>

<div class="org-src-container">
<pre class="src src-sh">MIX_ENV=prod PHX_SERVER=true mix release --path ~/my-app --overwrite 
</pre>
</div>

<p>
Run for localhsot.
</p>

<div class="org-src-container">
<pre class="src src-sh">SECRET_KEY_BASE='rwgfimMVc8/M6qZww/MCFtIWyP5KeXWrjKGbvMIaWp8BvBjm+st31cgsYy0s9wjL' PHX_SERVER=true PHX_HOST=localhost PORT=4040 ~/my-app/bin/my-app start
</pre>
</div>
</div>
</div>
<div id="outline-container-org1f3c5eb" class="outline-4">
<h4 id="org1f3c5eb"><a href="https://shaolang.github.io/posts/2021-06-04-phoenix-pubsub-comms-across-nodes/">Phoenix Pubsub comms across nodes</a></h4>
</div>
<div id="outline-container-org65b2d90" class="outline-4">
<h4 id="org65b2d90"><a href="https://felt.com/blog/startup-and-shutdown-for-phoenix-applications">Graceful startup and shutdown for Phoenix applications</a></h4>
<div class="outline-text-4" id="text-org65b2d90">
<ul class="org-ul">
<li>if you started your server with <code>iex -S mix phx.server</code> (which is what I use 95% of the time) then you can run <code>System.stop()</code></li>
<li>use <code>ps aux | grep 'mix phx.server'</code> to find the OS PID for the BEAM, then run <code>kill -s TERM &lt;os_pid&gt;</code></li>
</ul>

<p>
In GenServers add <code>Process.flag(:trap_exit, true)</code> along with the <code>terminate/2</code> callback.
</p>
</div>
</div>
<div id="outline-container-org2fdf02a" class="outline-4">
<h4 id="org2fdf02a">Dockerize Phoenix webapp (my<sub>app</sub>)</h4>
</div>
</div>
<div id="outline-container-org2384c54" class="outline-3">
<h3 id="org2384c54">Ecto</h3>
<div class="outline-text-3" id="text-org2384c54">
<ul class="org-ul">
<li><a href="https://hexdocs.pm/ecto/associations.html">https://hexdocs.pm/ecto/associations.html</a></li>
</ul>
</div>
</div>
<div id="outline-container-org2da3573" class="outline-3">
<h3 id="org2da3573">Inspecting data</h3>
<div class="outline-text-3" id="text-org2da3573">
<p>
How to use IO.inspect on a long list without trimming it? See <a href="https://hexdocs.pm/elixir/Inspect.Opts.html">Inspect.Opts</a> for a description of the available options, but in short:
</p>

<div class="org-src-container">
<pre class="src src-elixir">IO.inspect(list, limit: :infinity)
</pre>
</div>
</div>
</div>
<div id="outline-container-org6c9902d" class="outline-3">
<h3 id="org6c9902d">Phoenix Livebooks</h3>
<div class="outline-text-3" id="text-org6c9902d">
<ul class="org-ul">
<li><a href="https://notes.club/">Discover Livebook notebooks (Elixir)</a></li>
<li><a href="https://github.com/aslakjohansen/livebook-demos">https://github.com/aslakjohansen/livebook-demos</a></li>
<li><a href="https://github.com/Arp-G/async-elixir">https://github.com/Arp-G/async-elixir</a></li>
<li><a href="https://github.com/whatyouhide/guide_async_processing_in_elixir">https://github.com/whatyouhide/guide_async_processing_in_elixir</a></li>
</ul>
</div>
<div id="outline-container-org19e2adc" class="outline-4">
<h4 id="org19e2adc">Livebook Cluster</h4>
<div class="outline-text-4" id="text-org19e2adc">
<p>
I've experimented a bit with Livebook in the last two days. I was thinking it would be good to have livebooks sending messages each other; this way each livebook can live standalone and do something, but can eventually say "hey, I've these new information I like to share" and broadcast some message. Each livebook (and deployed apps) lives in his own node and has its own EPMD implementation. Using <a href="https://github.com/bitwalker/libcluster">libcluster</a> should be enough to make nodes to cluster together by using the <code>LocalEpmd</code> strategy. But it seems <code>PubSub</code> is not able to spot all nodes out (that's because , more info in <a href="https://elixirforum.com/t/cant-capture-a-livebook-up-in-a-cluster/57193/3">this thread</a>).
</p>

<p>
The issue is that livebooks are hidden nodes, PubSub is using pg2 and <a href="https://stackoverflow.com/questions/17191243/hidden-nodes-doesnt-see-pg2-groups">pg2 don't see hidden nodes</a>.
</p>

<p>
I've created the <a href="https://git.sr.ht/~minasmazar/livebook_cluster">livebook<sub>cluster</sub></a> package that uses <a href="https://github.com/bitwalker/libcluster">libcluster</a> and EPMD strategy on order to make livebooks to be connected. It seems working well, but I don't know if this implementation messes with deployment strategies or raises some sort of issue. Any feedback will be appreciated ;)
</p>

<p>
Adding <code>livebook_cluster</code> as dependency in my livebooks I was able to make three livebooks working together:
</p>

<ul class="org-ul">
<li>KV is just a key-value store to handle business logic information; it holds data and should act also provide cache and persist features</li>
<li><p>
Bifrost expose two HTTP entrypoints (page, event) using <code>Kino.Proxy</code>. Using a custom <a href="https://en.wikipedia.org/wiki/Userscript">userscript</a> (the code is present in the livebook) your browser will send sort of "page visits" events (across with the whole HTML <code>body</code>) and also keeps track of all events. The HTTP proxy then broadcast the message an all nodes using <code>Phoenix.PubSub</code>.
</p>

<div class="org-src-container">
<pre class="src src-text">livebook -&gt; PubSub (broadcast in current node)
</pre>
</div>

<p>
Remember that this open a wide range of <b><b>security issues</b></b>.. uses it with responsibility!
</p></li>
<li>Youtube</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgcd82e2b" class="outline-3">
<h3 id="orgcd82e2b">Dockerize</h3>
<div class="outline-text-3" id="text-orgcd82e2b">
</div>
<div id="outline-container-orgb6ce61e" class="outline-4">
<h4 id="orgb6ce61e">Example Dockerfile for Elixir app</h4>
<div class="outline-text-4" id="text-orgb6ce61e">
<p>
More info on <a href="#orgec65ab8">Docker here</a>.
</p>

<div class="org-src-container">
<pre class="src src-yml"># Find eligible builder and runner images on Docker Hub. We use Ubuntu/Debian
# instead of Alpine to avoid DNS resolution issues in production.
#
# https://hub.docker.com/r/hexpm/elixir/tags?page=1&amp;name=ubuntu
# https://hub.docker.com/_/ubuntu?tab=tags
#
# This file is based on these images:
#
#   - https://hub.docker.com/r/hexpm/elixir/tags - for the build image
#   - https://hub.docker.com/_/debian?tab=tags&amp;page=1&amp;name=bullseye-20230227-slim - for the release image
#   - https://pkgs.org/ - resource for finding needed packages
#   - Ex: hexpm/elixir:1.15.0-erlang-26.0-debian-bullseye-20230227-slim
#
ARG ELIXIR_VERSION=1.16.2
ARG OTP_VERSION=26.1.2
ARG DEBIAN_VERSION=bullseye-20240423-slim

ARG BUILDER_IMAGE="hexpm/elixir:${ELIXIR_VERSION}-erlang-${OTP_VERSION}-debian-${DEBIAN_VERSION}"
ARG RUNNER_IMAGE="debian:${DEBIAN_VERSION}"

FROM ${BUILDER_IMAGE} as builder

# install build dependencies
RUN apt-get update -y &amp;&amp; apt-get install -y build-essential git \
    &amp;&amp; apt-get clean &amp;&amp; rm -f /var/lib/apt/lists/*_*

# prepare build dir
WORKDIR /app

# install hex + rebar
RUN mix local.hex --force &amp;&amp; \
    mix local.rebar --force

# set build ENV
ENV MIX_ENV="prod"

# install mix dependencies
COPY mix.exs mix.lock ./
RUN mix deps.get --only $MIX_ENV
RUN mkdir config

# copy compile-time config files before we compile dependencies
# to ensure any relevant config change will trigger the dependencies
# to be re-compiled.
COPY config/config.exs config/${MIX_ENV}.exs config/
RUN mix deps.compile

COPY priv priv

COPY lib lib

COPY assets assets

# compile assets
RUN mix assets.deploy

# Compile the release
RUN mix compile

# Changes to config/runtime.exs don't require recompiling the code
COPY config/runtime.exs config/

COPY rel rel
RUN mix release

# start a new build stage so that the final image will only contain
# the compiled release and other runtime necessities
FROM ${RUNNER_IMAGE}

RUN apt-get update -y &amp;&amp; \
  apt-get install -y libstdc++6 openssl libncurses5 locales ca-certificates \
  &amp;&amp; apt-get clean &amp;&amp; rm -f /var/lib/apt/lists/*_*

# Set the locale
RUN sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen &amp;&amp; locale-gen

ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8

WORKDIR "/app"
RUN chown nobody /app

# set runner ENV
ENV MIX_ENV="prod"

# Only copy the final release from the build stage
COPY --from=builder --chown=nobody:root /app/_build/${MIX_ENV}/rel/my_app ./

USER nobody

# If using an environment that doesn't automatically reap zombie processes, it is
# advised to add an init process such as tini via `apt-get install`
# above and adding an entrypoint. See https://github.com/krallin/tini for details
# ENTRYPOINT ["/tini", "--"]

CMD ["/app/bin/server"]
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf823646" class="outline-4">
<h4 id="orgf823646">Docker compose</h4>
<div class="outline-text-4" id="text-orgf823646">
<div class="org-src-container">
<pre class="src src-yml"># Version of docker-compose.
version: '3'

# Containers we're going to run.
name: my_app

services:
   # Our Phoenix container.
   phoenix:
      # The build parameters for this container.
      build:
         # Here we define that it should build from the current directory.
         context: .
      environment:
         # Variables to connect to our Postgres server.
         DATABASE_URL: ecto://postgres:postgres@db:5432/my_app
         MIX_ENV: prod
         PHX_HOST: my_app.minasmazar.org
         SECRET_KEY_BASE: 50Ek5r7GwQlQCJlFi5y+O5Mmq0z/qHMRirG7IEim7w1B7H0fxnegANr0bRe26bE3
         # MY_APP_SSL_KEY_PATH: /root/my_app/priv/ssl/my_app.minasmazar.org-key.pem
         # MY_APP_SSL_CERT_PATH: /root/my_app/priv/ssl/my_app.minasmazar.org.pem
         PORT: 80
      ports:
         # Mapping the port to make the Phoenix app accessible outside of the container.
         - '80:80'
         - '443:443'
      expose:
        - '80'
        - '443'
      depends_on:
         # The DB container needs to be started before we start this container.
         - db
      networks:
        - outside
        - default
   db:
      # We use the predefined Postgres image.
      image: postgres:9.6
      environment:
         # Set user/password for Postgres.
         POSTGRES_USER: postgres
         POSTGRES_PASSWORD: postgres
         # Set a path where Postgres should store the data.
         PGDATA: /var/lib/postgresql/data/pgdata
      ports:
        - '5432:5432'
      expose:
        - '5432'
      restart: always
      volumes:
         - pgdata:/var/lib/postgresql/data
      networks:
        - default

# Define the volumes.
volumes:
   pgdata:

# Define networks
networks:
  outside:

</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb885b78" class="outline-3">
<h3 id="orgb885b78">Mocking (<a href="https://blog.plataformatec.com.br/2015/10/mocks-and-explicit-contracts/">a blogpost from Jos√© Valim</a>)</h3>
</div>
<div id="outline-container-orge8c848a" class="outline-3">
<h3 id="orge8c848a">Scale serverless with <a href="https://fly.io/blog/rethinking-serverless-with-flame/">FLAME</a>!</h3>
</div>
<div id="outline-container-orgdab52c4" class="outline-3">
<h3 id="orgdab52c4"><a href="https://nerves-project.org/newsletter/">Nerves</a></h3>
<div class="outline-text-3" id="text-orgdab52c4">
</div>
<div id="outline-container-org0fb0f99" class="outline-4">
<h4 id="org0fb0f99">Resources</h4>
<div class="outline-text-4" id="text-org0fb0f99">
<ul class="org-ul">
<li><a href="https://nerves-project.org/newsletter/">Nervers newsletter</a></li>
<li><a href="https://www.peterullrich.com/sending-text-messages-with-nerves">Sending text messages with Nerves</a></li>
</ul>
</div>
</div>
<div id="outline-container-org4d97a3e" class="outline-4">
<h4 id="org4d97a3e">Nerves + Livebook</h4>
<div class="outline-text-4" id="text-org4d97a3e">
<ul class="org-ul">
<li><a href="https://github.com/nerves-livebook">https://github.com/nerves-livebook</a></li>
<li><a href="https://hexdocs.pm/nerves_runtime/Nerves.Runtime.html">https://hexdocs.pm/nerves_runtime/Nerves.Runtime.html</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-elixir">Nerves.Runtime.halt()
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd4db2dc" class="outline-2">
<h2 id="orgd4db2dc">Embedded devices</h2>
<div class="outline-text-2" id="text-orgd4db2dc">
</div>
<div id="outline-container-orgd3087f6" class="outline-3">
<h3 id="orgd3087f6"><a href="#org3c3788b">Raspberry</a></h3>
</div>
<div id="outline-container-orgf27a040" class="outline-3">
<h3 id="orgf27a040"><a href="https://www.grisp.org/">GRiSP - the Power of Erlang &amp; Elixir Embedded Systems</a></h3>
</div>
</div>
<div id="outline-container-org7fefed4" class="outline-2">
<h2 id="org7fefed4"><a href="https://www.ffmpeg.org">FFmpeg</a></h2>
<div class="outline-text-2" id="text-org7fefed4">
<p>
A complete, cross-platform solution to record, convert and stream audio and video.
</p>
</div>
<div id="outline-container-org012c017" class="outline-3">
<h3 id="org012c017">Extract audio from video</h3>
<div class="outline-text-3" id="text-org012c017">
<pre class="example" id="org4b410a0">
ffmpeg -i infile.mp4 -vn -acodec copy outfile.ogg
</pre>
</div>
</div>
<div id="outline-container-orgb97832d" class="outline-3">
<h3 id="orgb97832d">Extract frames</h3>
<div class="outline-text-3" id="text-orgb97832d">
<p>
Extract a single frame at time 10s (also consider using <code>accurate_seek</code> argument).
</p>

<pre class="example" id="orgb4e82b6">
ffmpeg -i vid.mp4 -ss 10 -frames:v 1 thumb.png
</pre>

<p>
Extract a frame each minute.
</p>

<pre class="example" id="orgb05ddeb">
ffmpeg -i vid.mp4 -vf fps=1/60 thumb%03d.png
</pre>

<p>
Extract list of specific frames using ffmpeg. More details in this <a href="https://stackoverflow.com/questions/38253406/extract-list-of-specific-frames-using-ffmpeg">StackOverflow thread</a>.
</p>

<div class="org-src-container">
<pre class="src src-shell">ffmpeg -i in.mp4 -vf select='eq(n\,100)+eq(n\,184)+eq(n\,213)' -vsync 0 frames%d.jpg
</pre>
</div>

<blockquote>
<p>
FFmpeg is primarily a processor of timed video i.e. media with a cycle rate such as framerate or sample rate. It assumes that the output should be at the same rate as the source. If inadequate frames are supplied, it duplicates unless told not to. -vsync 0 is added which, in this case, tells it to suppress duplication.
</p>
</blockquote>

<p>
Using FFMPEG's scene detection to generate a <a href="https://blog.gdeltproject.org/using-ffmpegs-scene-detection-to-generate-a-visual-shot-summary-of-television-news/">visual shot summary of Television News</a>.
</p>

<div class="org-src-container">
<pre class="src src-shell">time ./ffmpeg -i ./VIDEO.mp4 -vf "select=gt(scene\,0.4),scale=160:-1,tile=6x80" -frames:v 1 -qscale:v 3 preview.jpg  
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc12386b" class="outline-3">
<h3 id="orgc12386b">Get an image from a webcam using V4L (video for Linux)</h3>
<div class="outline-text-3" id="text-orgc12386b">
<div class="org-src-container">
<pre class="src src-sh">ffmpeg -f v4l2 -video_size 1280x720 -i /dev/video0 -frames 1 out.jpg
</pre>
</div>
</div>
</div>
<div id="outline-container-org9860ecd" class="outline-3">
<h3 id="org9860ecd">Cut audio/videos starting from 10s from the beginning for 20s.</h3>
<div class="outline-text-3" id="text-org9860ecd">
<pre class="example" id="org7c3d924">
ffmpeg -ss 10 -t 20 -i infile.wav outfule.wav
</pre>

<p>
Another example using timing
</p>

<pre class="example" id="org1f6cd72">
ffmpeg -ss 00:00:15.00 -i in.mp4 -t 00:00:10.00 -c copy out.mp4
</pre>
</div>
</div>
<div id="outline-container-orgc33a834" class="outline-3">
<h3 id="orgc33a834">Adjust volume</h3>
<div class="outline-text-3" id="text-orgc33a834">
<p>
If we want our volume to be half of the input volume:
</p>
<pre class="example" id="orgee7a2ca">
ffmpeg -i input.wav -filter:a "volume=0.5" output.wav
</pre>

<p>
150% of current volume:
</p>
<pre class="example" id="org130c6d2">
ffmpeg -i input.wav -filter:a "volume=1.5" output.wav
</pre>

<p>
You can also use decibel measures. To increase the volume by 10dB:
</p>
<pre class="example" id="orgf1a3836">
ffmpeg -i input.wav -filter:a "volume=10dB" output.wav
</pre>
</div>
</div>
<div id="outline-container-orga5179c0" class="outline-3">
<h3 id="orga5179c0">Fade in/out</h3>
<div class="outline-text-3" id="text-orga5179c0">
<p>
For more details refer this <a href="https://video.stackexchange.com/questions/28269/how-do-i-fade-in-and-out-in-ffmpeg">StackOverlow thread</a>.
</p>

<p>
Fade in from second 0 to 5.
</p>

<pre class="example" id="orgd7ad938">
ffmpeg -i input.mp4 -af afade=in:0:d=5 output.mp4
</pre>
</div>
</div>
<div id="outline-container-orgd4fff4c" class="outline-3">
<h3 id="orgd4fff4c">Speeding up/slowing down video:</h3>
<div class="outline-text-3" id="text-orgd4fff4c">
<p>
The filter works by changing the presentation timestamp (PTS) of each
video frame. For example, if there are two succesive frames shown at
timestamps 1 and 2, and you want to speed up the video, those
timestamps need to become 0.5 and 1, respectively. Thus, we have to
multiply them by 0.5.
</p>

<p>
To double the speed of the video, you can use:
</p>
<pre class="example" id="org40cca0a">
ffmpeg -i input.mkv -filter:v "setpts=0.5*PTS" output.mkv
</pre>

<p>
To slow down your video, you have to use a multiplier greater than 1:
</p>
<pre class="example" id="org0066849">
ffmpeg -i input.mkv -filter:v "setpts=2.0*PTS" output.mkv
</pre>

<p>
For audio I found this
</p>

<div class="org-src-container">
<pre class="src src-sh">ffmpeg -i input.wav -filter:a "atempo=0.75" output.mp3 
</pre>
</div>
</div>
</div>
<div id="outline-container-org33c0cdc" class="outline-3">
<h3 id="org33c0cdc">Concat audio/videos starting from a list of files</h3>
<div class="outline-text-3" id="text-org33c0cdc">
<pre class="example" id="org62261b4">
ffmpeg -f concat -i list-of-files.txt -c copy outfile.wav
</pre>

<p>
The <code>list-of-files.txt</code> should be something like this:
</p>

<pre class="example" id="orga30e461">
file './infile.wav'
file './infile.wav'
file './infile.wav'
file './infile.wav'
file './infile.wav'
file './infile.wav'
</pre>

<p>
<b><b>N.B.</b></b> you could see the error 'Unsafe filename..Operation not permitted'; as reported in <a href="https://stackoverflow.com/questions/38996925/ffmpeg-concat-unsafe-file-name">this SO thread</a> you could solve this issue by using single quotes in the list of filenames, avoiding any <code>~</code> or other <i>"strange"</i> chars.
</p>
</div>
</div>
<div id="outline-container-org17ce2f2" class="outline-3">
<h3 id="org17ce2f2">Scene detection</h3>
<div class="outline-text-3" id="text-org17ce2f2">
<p>
Basic ffmpeg scene detection:
</p>

<div class="org-src-container">
<pre class="src src-sh">ffmpeg -i input.flv -filter:v "select='gt(scene,0.4)',showinfo" -f null -
# or
ffmpeg -i in.mp4 -vf "select='gte(scene,0.4)',metadata=print:file=scenescores.txt" -an -f null -
</pre>
</div>

<p>
scene (video only) value between 0 and 1 to indicate a new scene; a low value reflects a low probability for the current frame to introduce a new scene, while a higher value means the current frame is more likely to be one (see the example below) <a href="https://ffmpeg.org/ffmpeg-filters.html#select_002c-aselect">https://ffmpeg.org/ffmpeg-filters.html#select_002c-aselect</a>. Set the scene change detection threshold as a percentage of maximum change on the luma plane. Good values are in the [8.0, 14.0] range. Scene change detection is only relevant in case combmatch=sc. The range for scthresh is [0.0, 100.0]. <a href="https://ffmpeg.org/ffmpeg-filters.html">https://ffmpeg.org/ffmpeg-filters.html</a>
</p>

<ul class="org-ul">
<li><a href="https://github.com/slhck/scenecut-extractor">Scenecut Extractor (python)</a></li>
<li><a href="https://www.scenedetect.com/">PySceneDetect</a></li>
<li><a href="https://trac.ffmpeg.org/ticket/442">FFMPEG Ticket</a></li>
<li><a href="https://publik.tuwien.ac.at/files/pub-et_9739.pdf">SCENE CHANGE DETECTION FOR H.264 USING DYNAMIC THRESHOLD TECHNIQUES</a></li>
</ul>
</div>
</div>
<div id="outline-container-org05c74e5" class="outline-3">
<h3 id="org05c74e5">Change sample rate</h3>
<div class="outline-text-3" id="text-org05c74e5">
<p>
Converts a.wav to MPEG audio at 22050 Hz sample rate.
</p>

<pre class="example" id="org53b0e0f">
ffmpeg -i /tmp/a.wav -ar 22050 /tmp/a.mp2
</pre>
</div>
</div>
<div id="outline-container-orge7bed55" class="outline-3">
<h3 id="orge7bed55">Edit ID3 Tags</h3>
<div class="outline-text-3" id="text-orge7bed55">
<p>
You can follow <a href="https://gist.github.com/eyecatchup/0757b3d8b989fe433979db2ea7d95a01">this gist</a>.
</p>
<pre class="example" id="orge44248d">
ffmpeg -i file.mp3 -metadata title="Track Title" -metadata artist="The artist" -metadata album="Album name" out.mp3
</pre>
</div>
</div>
<div id="outline-container-orgbf22171" class="outline-3">
<h3 id="orgbf22171">Capture audio</h3>
<div class="outline-text-3" id="text-orgbf22171">
<p>
Taken from <a href="https://trac.ffmpeg.org/wiki/Capture/Desktop">FFMPEG doc</a>
</p>
</div>
<ul class="org-ul">
<li><a id="org9a04355"></a>Linux<br />
<div class="outline-text-5" id="text-org9a04355">
<p>
Use the x11grab device:
</p>

<div class="org-src-container">
<pre class="src src-sh">ffmpeg -video_size 1024x768 -framerate 25 -f x11grab -i :0.0+100,200 output.mp4
</pre>
</div>
<p>
This will grab the image from desktop, starting with the upper-left corner at x=100, y=200 with a width and height of 1024‚®â768.
</p>

<p>
If you need audio too, you can use ALSA (see Capture/ALSA for more info):
</p>

<div class="org-src-container">
<pre class="src src-sh">ffmpeg -video_size 1024x768 -framerate 25 -f x11grab -i :0.0+100,200 -f alsa -ac 2 -i hw:0 output.mkv
</pre>
</div>

<p>
Or the pulse input device (see Capture/PulseAudio for more info):
</p>

<div class="org-src-container">
<pre class="src src-sh">ffmpeg -video_size 1024x768 -framerate 25 -f x11grab -i :0.0+100,200 -f pulse -ac 2 -i default output.mkv
</pre>
</div>
</div>
<ul class="org-ul">
<li><a id="orgeebafa3"></a>macOS<br />
<div class="outline-text-6" id="text-orgeebafa3">
<p>
Use the avfoundation device:
</p>

<div class="org-src-container">
<pre class="src src-sh">ffmpeg -f avfoundation -list_devices true -i ""
</pre>
</div>

<p>
This will enumerate all the available input devices including screens ready to be captured.
</p>

<p>
Once you've figured out the device index corresponding to the screen to be captured, use:
</p>

<div class="org-src-container">
<pre class="src src-sh">ffmpeg -f avfoundation -i "&lt;screen device index&gt;:&lt;audio device index&gt;" output.mkv
</pre>
</div>

<p>
This will capture the screen from &lt;screen device index&gt; and audio from &lt;audio device index&gt; into the output file output.mkv.
</p>

<p>
To capture only audio, something like this:
</p>

<div class="org-src-container">
<pre class="src src-sh">ffmpeg -f avfoundation -i ":default" output.wav
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org6d72bf5" class="outline-2">
<h2 id="org6d72bf5">Git</h2>
<div class="outline-text-2" id="text-org6d72bf5">
<p>
How do I change the author and committer name/email for multiple commits?
</p>

<div class="org-src-container">
<pre class="src src-sh">git rebase -r a5bf6c2 --exec 'git commit --amend --no-edit --reset-author'
</pre>
</div>

<p>
Generate a patch
</p>

<div class="org-src-container">
<pre class="src src-sh">git diff &gt; my_custom_patch_file.patch
</pre>
</div>

<p>
Apply the patch
</p>

<div class="org-src-container">
<pre class="src src-sh">git apply patch_file.patch 
</pre>
</div>

<p>
How to add chmod permissions to file in Git (<a href="https://git-scm.com/docs/git-update-index#Documentation/git-update-index.txt---chmod-x">official doc</a>)
</p>

<div class="org-src-container">
<pre class="src src-sh">git update-index --chmod=+x path/to/file
</pre>
</div>

<p>
Use <code>git bundle</code> to backup a repo with all branches; <code>repo.bundle</code> is the file what you need (full back up) in the same directory.
</p>

<div class="org-src-container">
<pre class="src src-sh">git bundle create repo.bundle --all
</pre>
</div>

<p>
To restore the bundle
</p>

<div class="org-src-container">
<pre class="src src-sh">git clone repo.bundle
</pre>
</div>

<p>
The <code>git clone repo.bundle</code> can be used to restore repositories in the tarball exported account data in Github (<a href="https://github.com/settings/admin">https://github.com/settings/admin</a> -&gt; Account -&gt; Export account data)
</p>
</div>
</div>
<div id="outline-container-org7e84fa6" class="outline-2">
<h2 id="org7e84fa6">Google Chrome &amp; chromedriver</h2>
<div class="outline-text-2" id="text-org7e84fa6">
<p>
Download chromedriver version according to the version of Google Chrome installed.
</p>
<ul class="org-ul">
<li><a href="https://googlechromelabs.github.io/chrome-for-testing/">https://googlechromelabs.github.io/chrome-for-testing/</a></li>
</ul>

<p>
How to get rid of "Choose your search engine" dialog in Chrome v.127 on Selenium test run?
</p>

<div class="org-src-container">
<pre class="src src-sh">chromedriver --disable-search-engine-choice-screen
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbcbfb9e" class="outline-2">
<h2 id="orgbcbfb9e"><a href="https://guix.gnu.org/">GNU Guix</a></h2>
<div class="outline-text-2" id="text-orgbcbfb9e">
<p>
My <code>~/.profile</code> after having installed guix on an Ubuntu distro.
</p>

<div class="org-src-container">
<pre class="src src-sh"># Enable Guix
export GUIX_LOCPATH="$HOME/.guix-profile/lib/locale"
GUIX_PROFILE="/home/invisigoth/.guix-profile"
. "$GUIX_PROFILE/etc/profile"

# after guix install nss-certs
export SSL_CERT_DIR="$HOME/.guix-profile/etc/ssl/certs"
export SSL_CERT_FILE="$HOME/.guix-profile/etc/ssl/certs/ca-certificates.crt"
</pre>
</div>
</div>
</div>
<div id="outline-container-org9702aa2" class="outline-2">
<h2 id="org9702aa2">GPG and SSH</h2>
<div class="outline-text-2" id="text-org9702aa2">
</div>
<div id="outline-container-org289e022" class="outline-3">
<h3 id="org289e022">Generate key</h3>
<div class="outline-text-3" id="text-org289e022">
<p>
Ref. <a href="https://docs.github.com/en/authentication/managing-commit-signature-verification/generating-a-new-gpg-key">https://docs.github.com/en/authentication/managing-commit-signature-verification/generating-a-new-gpg-key</a>
</p>

<p>
Remember to execute in a terminal capable of reading password via ncurses-like input method.
</p>

<div class="org-src-container">
<pre class="src src-sh">gpg --full-generate-key
</pre>
</div>
</div>
</div>
<div id="outline-container-org6c382f7" class="outline-3">
<h3 id="org6c382f7">List the key</h3>
<div class="outline-text-3" id="text-org6c382f7">
<div class="org-src-container">
<pre class="src src-sh">gpg --list-secret-keys --keyid-format=long
</pre>
</div>
</div>
</div>
<div id="outline-container-org2ee82a0" class="outline-3">
<h3 id="org2ee82a0">Get the armored key text</h3>
<div class="outline-text-3" id="text-org2ee82a0">
<div class="org-src-container">
<pre class="src src-sh">gpg --armor --export KEYID
</pre>
</div>
</div>
</div>
<div id="outline-container-org81cb160" class="outline-3">
<h3 id="org81cb160">Upload to Github</h3>
<div class="outline-text-3" id="text-org81cb160">
<p>
Ref. <a href="https://docs.github.com/en/authentication/managing-commit-signature-verification/adding-a-new-gpg-key-to-your-github-account">https://docs.github.com/en/authentication/managing-commit-signature-verification/adding-a-new-gpg-key-to-your-github-account</a>
</p>

<p>
From the list of GPG keys, copy the long form of the GPG key ID you'd like to use. In this example, the GPG key ID is <code>3AA5C34371567BD2</code>:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ gpg --list-secret-keys --keyid-format=long
</pre>
</div>

<p>
This will output something like
</p>

<div class="org-src-container">
<pre class="src src-nil">/Users/hubot/.gnupg/secring.gpg
------------------------------------
sec   4096R/3AA5C34371567BD2 2016-03-10 [expires: 2017-03-10]
uid                          Hubot
ssb   4096R/42B317FD4BA89E7A 2016-03-10
</pre>
</div>

<p>
Paste the text below, substituting in the GPG key ID you'd like to use. In this example, the GPG key ID is <code>3AA5C34371567BD2</code>:
</p>

<div class="org-src-container">
<pre class="src src-sh">$ gpg --armor --export 3AA5C34371567BD2
</pre>
</div>

<p>
Copy your GPG key, beginning with &#x2013;&#x2014;BEGIN PGP PUBLIC KEY BLOCK&#x2013;&#x2014; and ending with &#x2013;&#x2014;END PGP PUBLIC KEY BLOCK&#x2013;&#x2014;.
</p>
</div>
</div>
<div id="outline-container-org9152cfa" class="outline-3">
<h3 id="org9152cfa">Tell Git to use GPG key</h3>
<div class="outline-text-3" id="text-org9152cfa">
<p>
Ref. <a href="https://docs.github.com/en/authentication/managing-commit-signature-verification/telling-git-about-your-signing-key">https://docs.github.com/en/authentication/managing-commit-signature-verification/telling-git-about-your-signing-key</a>
</p>

<p>
Use the <code>gpg --list-secret-keys --keyid-format=long</code> command to list the long form of the GPG keys for which you have both a public and private key. A private key is required for signing commits or tags (same ID as for <i>Upload to Github</i>). Then:
</p>

<div class="org-src-container">
<pre class="src src-sh">git config --global user.signingkey 3AA5C34371567BD2
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc46b480" class="outline-3">
<h3 id="orgc46b480">Export key pair</h3>
<div class="outline-text-3" id="text-orgc46b480">
<p>
Ref. <a href="https://unix.stackexchange.com/questions/481939/how-to-export-a-gpg-private-key-and-public-key-to-a-file">https://unix.stackexchange.com/questions/481939/how-to-export-a-gpg-private-key-and-public-key-to-a-file</a>
</p>
</div>
<div id="outline-container-org2b05e59" class="outline-4">
<h4 id="org2b05e59">Export Public Key</h4>
<div class="outline-text-4" id="text-org2b05e59">
<p>
This command will export an ascii armored version of the public key:
</p>

<div class="org-src-container">
<pre class="src src-sh">gpg --output public.pgp --armor --export username@email
</pre>
</div>

<p>
N.B. when using <code>--armor</code> maybe the file extension name should be <code>.asc</code>.
</p>
</div>
</div>
<div id="outline-container-org6d1e659" class="outline-4">
<h4 id="org6d1e659">Export Secret Key</h4>
<div class="outline-text-4" id="text-org6d1e659">
<p>
This command will export an ascii armored version of the secret key:
</p>

<div class="org-src-container">
<pre class="src src-sh">gpg --output private.pgp --armor --export-secret-key username@email
</pre>
</div>

<p>
N.B. when using <code>--armor</code> maybe the file extension name should be <code>.asc</code>.
</p>

<p>
Or <a href="https://unix.stackexchange.com/questions/481939/how-to-export-a-gpg-private-key-and-public-key-to-a-file">if the purpose is to create a backup key, you should use the backup option</a>:
</p>

<div class="org-src-container">
<pre class="src src-sh">gpg --output backupkeys.pgp --armor --export-secret-keys --export-options export-backup user@email
</pre>
</div>
</div>
</div>
<div id="outline-container-orge5e00d4" class="outline-4">
<h4 id="orge5e00d4">Security Concerns, Backup, and Storage</h4>
<div class="outline-text-4" id="text-orge5e00d4">
<p>
A PGP public key contains information about one's email address. This is generally acceptable since the public key is used to encrypt email to your address. However, in some cases, this is undesirable.
</p>

<p>
For most use cases, the secret key need not be exported and should not be distributed. If the purpose is to create a backup key, you should use the backup option:
</p>

<div class="org-src-container">
<pre class="src src-shell">gpg --output backupkeys.pgp --armor --export-secret-keys --export-options export-backup user@email
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc01f9fa" class="outline-3">
<h3 id="orgc01f9fa">Import a key</h3>
<div class="outline-text-3" id="text-orgc01f9fa">
<div class="org-src-container">
<pre class="src src-shell">gpg --import my-key.asc
gpg --import --allow-secret-key-import private.key
</pre>
</div>
</div>
</div>
<div id="outline-container-org2dba61d" class="outline-3">
<h3 id="org2dba61d">Troubleshooting</h3>
<div class="outline-text-3" id="text-org2dba61d">
<p>
Interesting resources if you encounter problems:
</p>
<ul class="org-ul">
<li><a href="https://gist.github.com/paolocarrasco/18ca8fe6e63490ae1be23e84a7039374">https://gist.github.com/paolocarrasco/18ca8fe6e63490ae1be23e84a7039374</a></li>
</ul>

<p>
If every gpg command goes timeout  with a message like <code>gpg: Nota: database_open 134217901 waiting for lock (held by 31477)</code> you could try to solve via:
</p>

<div class="org-src-container">
<pre class="src src-sh">rm -rf ~/.gnupg/*.lock
rm -rf ~/.gnupg/public-keys.d/*.lock
</pre>
</div>
</div>
</div>
<div id="outline-container-org53ebfc1" class="outline-3">
<h3 id="org53ebfc1">Generate SSH keys</h3>
<div class="outline-text-3" id="text-org53ebfc1">
<p>
From <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">GitHub docs</a>:
</p>

<div class="org-src-container">
<pre class="src src-sh">ssh-keygen -t ed25519 -C "your_email@example.com"
</pre>
</div>
</div>
</div>
<div id="outline-container-org1837105" class="outline-3">
<h3 id="org1837105">GPG Agent: cache and timeouts</h3>
<div class="outline-text-3" id="text-org1837105">
</div>
<ul class="org-ul">
<li><a id="org19d5440"></a>Keep GnuPG credentials cached for entire user session<br />
<div class="outline-text-5" id="text-org19d5440">
<p>
For GnuPG 2.1 and below edit user configuration file at <code>~/.gnupg/gpg-agent.conf</code>. In the example below the TTL is set to 3h.
</p>

<div class="org-src-container">
<pre class="src src-sh">default-cache-ttl 18000
max-cache-ttl 18000
</pre>
</div>

<p>
Then restart the agent
</p>

<div class="org-src-container">
<pre class="src src-sh">gpgconf --kill gpg-agent
gpg-agent --daemon --use-standard-socket
</pre>
</div>
</div>
</li>
<li><a id="orgbb6edf5"></a>Cache SSH keys<br />
<div class="outline-text-5" id="text-orgbb6edf5">
<p>
If you want to use SSH but tired of insert SSH key on every (for instance) git operation
</p>

<div class="org-src-container">
<pre class="src src-sh">eval `ssh-agent -s`
ssh-add
</pre>
</div>

<blockquote>
<p>
SSH needs two things in order to use ssh-agent: an ssh-agent instance
running in the background, and an environment variable set that tells
SSH which socket it should use to connect to the agent (SSH<sub>AUTH</sub><sub>SOCK</sub>
IIRC). If you just run ssh-agent then the agent will start, but SSH
will have no idea where to find it.
</p>
</blockquote>

<p>
More info in this <a href="https://stackoverflow.com/questions/17846529/could-not-open-a-connection-to-your-authentication-agent">SO thread</a>.
</p>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-org61808a4" class="outline-2">
<h2 id="org61808a4">How to set environment variables from .env file</h2>
<div class="outline-text-2" id="text-org61808a4">
<div class="org-src-container">
<pre class="src src-sh">set -a # automatically export all variables
source .env
set +a
</pre>
</div>
</div>
</div>
<div id="outline-container-org4083e12" class="outline-2">
<h2 id="org4083e12">HTML &amp; CSS</h2>
<div class="outline-text-2" id="text-org4083e12">
<ul class="org-ul">
<li><a href="https://remixicon.com/">https://remixicon.com/</a></li>
<li><a href="https://yaml.org/css/screen.css">https://yaml.org/css/screen.css</a></li>
</ul>
</div>
</div>
<div id="outline-container-org2923b75" class="outline-2">
<h2 id="org2923b75"><a href="https://imagemagick.org/index.php">Imagemagick</a></h2>
<div class="outline-text-2" id="text-org2923b75">
</div>
<div id="outline-container-orga64d697" class="outline-3">
<h3 id="orga64d697"><a href="https://imagemagick.org/script/compare.php">Compare two images</a></h3>
<div class="outline-text-3" id="text-orga64d697">
<div class="org-src-container">
<pre class="src src-sh">magick compare -metric NCC -subimage-search logo.png hat.png similarity.png
</pre>
</div>
</div>
</div>
<div id="outline-container-orgac91af9" class="outline-3">
<h3 id="orgac91af9">Resize image</h3>
<div class="outline-text-3" id="text-orgac91af9">
<div class="org-src-container">
<pre class="src src-sh">convert dragon_sm.gif -resize 64x64 resize_dragon.gif
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd0dbe22" class="outline-3">
<h3 id="orgd0dbe22">Annotating image</h3>
<div class="outline-text-3" id="text-orgd0dbe22">
<p>
Most of info taken from <a href="https://legacy.imagemagick.org/Usage/annotating/">this page</a>.
</p>

<p>
If you want to add a text stripe under the image
</p>

<div class="org-src-container">
<pre class="src src-sh">convert original-image.jpg -background Khaki -font Arial -pointsize 27 label:'Sfilatini Buitoni' -gravity Center -append out-image.jpg 
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd04c735" class="outline-3">
<h3 id="orgd04c735">Set an image as wallpaper</h3>
<div class="outline-text-3" id="text-orgd04c735">
<p>
You can also use a remote image, like <img src="https://picsum.photos/1920/1080.jpg" alt="1080.jpg" />
</p>
<div class="org-src-container">
<pre class="src src-sh">display -size 1920x1080 -window root /path/to/image.jpg
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org028a244" class="outline-2">
<h2 id="org028a244">Javascript</h2>
<div class="outline-text-2" id="text-org028a244">
<p>
Get all links from a page and extract only the <code>href</code> attribute. More info on <code>querySelectorAll</code> and iteration in <a href="https://css-tricks.com/snippets/javascript/loop-queryselectorall-matches/">this article</a>.
</p>

<div class="org-src-container">
<pre class="src src-javascript">const links = [...document.querySelectorAll("a")].flatMap(el =&gt; el.href); 
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd6e842c" class="outline-2">
<h2 id="orgd6e842c">Linux</h2>
<div class="outline-text-2" id="text-orgd6e842c">
</div>
<div id="outline-container-org1eac6b7" class="outline-3">
<h3 id="org1eac6b7">Brief list of useful commands, examples, snippets</h3>
<div class="outline-text-3" id="text-org1eac6b7">
<ul class="org-ul">
<li><code>lsb_release -a</code> show info about distro</li>
<li><code>lsblk -f</code> show partitions informations</li>
<li><code>pacman -Qq</code> / <code>apt list --installed</code> / <code>dnf list install</code> show installed packages (Arch, Debian, Fedora)</li>
<li><code>sudo update-alternatives --config x-session-manager</code> and <code>stat /etc/alternatives/x-session-manager</code></li>
<li><code>ls -1 | wc -l</code> determine how many files there are in a directory</li>
<li><code>echo $XDG_SESSION_TYPE</code> show if you're using the X session manager is use (X11 or Wayland)</li>
</ul>
</div>
</div>
<div id="outline-container-orga225570" class="outline-3">
<h3 id="orga225570">Set keyboard layout</h3>
<div class="outline-text-3" id="text-orga225570">
<p>
From <a href="https://www.baeldung.com/linux/console-change-keyboard-layout">https://www.baeldung.com/linux/console-change-keyboard-layout</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">cat .Xmodmap

!
! Swap Caps_Lock and Control_L
!
remove Lock = Caps_Lock
remove Control = Control_L
remove Lock = Control_L
remove Control = Caps_Lock
keysym Control_L = Caps_Lock
keysym Caps_Lock = Control_L
add Lock = Caps_Lock
add Control = Control_L
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell">localectl list-x11-keymap-layouts # get the list of all keyboard layouts..
localectl list-x11-keymap-layouts-variants # .. and their variants
setxkbmap layout 'us,it' -option 'grp:alt_shift_toggle'
xmodmap .Xmodmap
</pre>
</div>

<p>
To permanently configure edit the <code>/etc/default/keyboard</code> file, if present, or use <code>localectl</code>.
</p>
</div>
</div>
<div id="outline-container-org5b078c7" class="outline-3">
<h3 id="org5b078c7">Show preferred applications (alternatives)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="debian">debian</span></span></h3>
<div class="outline-text-3" id="text-org5b078c7">
<div class="org-src-container">
<pre class="src src-sh">update-alternatives --get-selections
</pre>
</div>
</div>
</div>
<div id="outline-container-org4f92d32" class="outline-3">
<h3 id="org4f92d32">Change the ownership of a input device, like a usb mouse</h3>
<div class="outline-text-3" id="text-org4f92d32">
<p>
Retrive information of device through
</p>

<div class="org-src-container">
<pre class="src src-sh">udevadm info --attribute-walk --name /dev/input/mouse0
</pre>
</div>

<p>
Then add a rule in <i>etc/udev/rules.d</i>
</p>

<div class="org-src-container">
<pre class="src src-sh">SUBSYSTEM=="input", KERNEL=="mouse0", OWNER="myusername"
</pre>
</div>
</div>
</div>
<div id="outline-container-orga72b31b" class="outline-3">
<h3 id="orga72b31b">Opena a remote desktop session on a PCDuino</h3>
<div class="outline-text-3" id="text-orga72b31b">
<p>
Configuring The VNC Server
</p>

<p>
As it turns out, the pcDuino comes with the x11vnc server already installed and all that‚Äôs necessary is to configure SSH on the pcDuino and local machine to support it.  (Note:  while working on putting together a bootable SD card I found out this is not necessarily the case.  If you find the x11vnc server is not installed, you can do so by executing the command from the pcDuino command line.)
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo apt-get install x11vnc
</pre>
</div>

<p>
On the local machine and change to the /etc/ssh directory as root:
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo su
cd /etc/ssh
</pre>
</div>

<p>
Open the file ssh<sub>config</sub> file in your editor of choice and find the ForwardX11 option.  Uncomment it if necessary, change its value to YES, and save the file.
</p>

<p>
Now log into the pcDuino via the SSH link and gain root access in the same manner:
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo su
cd /etc/ssh
</pre>
</div>

<p>
Open the file sshd<sub>config</sub> file in your editor of choice, find the X11Forwarding option, change its value to YES, and save the file.
</p>

<p>
Install and Connect Via a VNC Client
</p>

<p>
The final step is to install a VNC client on your local computer.  There are a number of them to choose from.  Of these, I chose xtightvncviewer for no other reason than it was there, installing it as:
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo apt-get install xtightvncviewer
</pre>
</div>

<p>
Putting It All Together
</p>

<p>
At this point if you SSH into the pcDuino and try to start the VNC server, you‚Äôll get an error indicating you cannot connect to the display (XOpenDisplay failed) along with hints on how to fix it.  The cause of this error is that the account used for SSH does not have sufficient permissions to connect to the X display.
</p>

<p>
To fix this, execute the command ps -fe | grep <i>usr/bin/X | grep -v grep from the pcDuino command line.  The returned process will have have an -auth flag.  Take note of the associated file. On my machine, it was /var/run/lightdm/root</i>:0.
</p>

<p>
Exit from the SSH session and reconnect to the pcDuino using the command
</p>

<div class="org-src-container">
<pre class="src src-sh">ssh -L 5900:localhost:5900 &lt;user&gt;@&lt;pcDuino_ip_address&gt; ‚Äòsudo x11vnc -auth &lt;path_to_authority_file&gt;‚Äô -display :0
</pre>
</div>

<p>
where &lt;path<sub>to</sub><sub>authority</sub><sub>file</sub>&gt; is the file associated with the -auth flag noted above.  This will log you into the pcDuino via SSH and start an instance of the X server.  You can then start the VNC viewer from the local machine command line with the command:
</p>

<div class="org-src-container">
<pre class="src src-sh">vncviewer localhost:5900 &amp;
</pre>
</div>
</div>
</div>
<div id="outline-container-org77184ae" class="outline-3">
<h3 id="org77184ae">How do I get a list of installed files from a package?</h3>
<div class="outline-text-3" id="text-org77184ae">
<p>
To see all the files the package installed onto your system, do this:
</p>

<div class="org-src-container">
<pre class="src src-sh">dpkg-query -L &lt;package_name&gt;
</pre>
</div>

<p>
To see the files a .deb file will install
</p>

<div class="org-src-container">
<pre class="src src-sh">dpkg-deb -c &lt;package_name.deb&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org7bf3e10" class="outline-3">
<h3 id="org7bf3e10">Add a custom window manager entry for <a href="https://wiki.ubuntu.com/LightDM">LightDM</a></h3>
<div class="outline-text-3" id="text-org7bf3e10">
<p>
Add a file in <code>/usr/share/xsessions/</code> with something like this (example for <code>i3</code>)
</p>

<div class="org-src-container">
<pre class="src src-toml">[Desktop Entry]
Name=i3
Comment=improved dynamic tiling window manager
Exec=i3
TryExec=i3
Type=Application
X-LightDM-DesktopName=i3
DesktopNames=i3
Keywords=tiling;wm;windowmanager;window;manager;
</pre>
</div>
</div>
</div>
<div id="outline-container-org7f13ef7" class="outline-3">
<h3 id="org7f13ef7">Audio management</h3>
<div class="outline-text-3" id="text-org7f13ef7">
</div>
<div id="outline-container-orgac15f7f" class="outline-4">
<h4 id="orgac15f7f">Alsamixer</h4>
<div class="outline-text-4" id="text-orgac15f7f">
<p>
Toggle mute
</p>

<div class="org-src-container">
<pre class="src src-sh">amixer set Master toggle
</pre>
</div>
</div>
</div>
<div id="outline-container-org42ab8aa" class="outline-4">
<h4 id="org42ab8aa">Pulseaudio</h4>
<div class="outline-text-4" id="text-org42ab8aa">
<ul class="org-ul">
<li><a href="https://wiki.archlinux.org/title/PulseAudio/Examples">https://wiki.archlinux.org/title/PulseAudio/Examples</a></li>

<li><code>pactl list sinks short</code> get the sink list with some additional info, the first column is the INDEX</li>
<li><code>pactl get-sink-volume &lt;INDEX&gt;</code> get the volume of the given sink</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">aplay -l
pactl list short sinks
pactl list short sink-inputs
pactl move-sink-input 2144 0
</pre>
</div>
</div>
</div>
<div id="outline-container-org41e6289" class="outline-4">
<h4 id="org41e6289"><a href="https://github.com/mikeroyal/PipeWire-Guide/blob/main/README.md">PipeWire</a></h4>
</div>
</div>
<div id="outline-container-orgf7e2999" class="outline-3">
<h3 id="orgf7e2999">Create a .desktop File</h3>
<div class="outline-text-3" id="text-orgf7e2999">
<p>
Useful when installing an app via <code>flatpak</code>. In userspace at <code>~/.local/share/applications/</code> or <code>~/.config/autostart</code> to start at login.
</p>

<div class="org-src-container">
<pre class="src src-toml">[Desktop Entry]
Type=Application
Name=Clock
Exec=/usr/bin/python3 /home/pi/clock.py
</pre>
</div>
</div>
</div>
<div id="outline-container-orgce9b0ab" class="outline-3">
<h3 id="orgce9b0ab"><a href="https://superuser.com/questions/644804/disable-screensaver-screen-blank-via-command-line">Handling screen saver / blank screen</a></h3>
<div class="outline-text-3" id="text-orgce9b0ab">
<p>
<code>xset s off</code> (turns off the screen saver)
<code>xset s noblank</code> (turns off blanking)
<code>xset -dpms</code> (disable the power management)
</p>
</div>
</div>
<div id="outline-container-org13859cc" class="outline-3">
<h3 id="org13859cc">Read battery status from command-line</h3>
<div class="outline-text-3" id="text-org13859cc">
<p>
Here's a <a href="https://askubuntu.com/questions/69556/how-do-i-check-the-batterys-status-via-the-terminal">StackOverlow thread</a>: from Linux 4.20 <code>cat /sys/class/power_supply/BAT1/status</code>; check the link for old methods.
</p>
</div>
</div>
<div id="outline-container-org451fa0b" class="outline-3">
<h3 id="org451fa0b">iptables</h3>
<div class="outline-text-3" id="text-org451fa0b">
<p>
Iptables rules used to configure a router on linux
</p>

<div class="org-src-container">
<pre class="src src-txt">WAN='wlp7s0'
LAN='enp7s0'

iptables -F
iptables -P INPUT DROP
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT

iptables -A INPUT -m state --state=RELATED,ESTABLISHED -j ACCEPT
iptables -A INPUT -i $LAN -j ACCEPT

# iptables -A FORWARD -m state --state=RELATED,ESTABLISHED -j ACCEPT

iptables -t nat -F
# iptables -t nat -A POSTROUTING -s 172.16.0.0/20 -o $WAN -j MASQUERADE
iptables -t nat -A POSTROUTING -o $WAN -j MASQUERADE
</pre>
</div>
</div>
</div>
<div id="outline-container-org0498bdb" class="outline-3">
<h3 id="org0498bdb">Screen managing</h3>
<div class="outline-text-3" id="text-org0498bdb">
<p>
Here's <a href="https://pimylifeup.com/raspberry-pi-screen-resolution/">a good blogpost</a> specific for Raspberry PI.
</p>

<p>
If you're using the LightDM and you want to set monitor resolutions and layout at the startup, edit the <code>display-setup-script</code> option in <code>/etc/lightdm/lightdm.conf</code>.
</p>
</div>
<div id="outline-container-org7c0aedc" class="outline-4">
<h4 id="org7c0aedc">X11 / xrandr</h4>
<div class="outline-text-4" id="text-org7c0aedc">
<p>
Remember to set <code>DISPLAY</code> env in the console before using <code>xrandr</code> (usually <code>export DISPLAY=:0</code>)
</p>

<blockquote>
<p>
I use this command to mirror my desktop with my external VGA:
</p>

<p>
$ xrandr &#x2013;output LVDS-1 &#x2013;mode 1366x768 &#x2013;scale 1x1 &#x2013;output VGA-1 &#x2013;same-as LVDS-1 &#x2013;mode 1920x1080 &#x2013;scale 0.711x0.711
</p>

<p>
LVDS-1 is the laptop screen , natively working in 1366x768.
</p>

<p>
VGA-1 is my external VGA monitor, with native resolution of 1920x1080, scaled to 0.711 which equals close to 1366x768 (laptop resolution).
</p>

<p>
Results are good for me. You can experiment with those options.
</p>

<p>
Similarly, I use this one for extended desktop:
</p>

<p>
$ xrandr &#x2013;output VGA-1 &#x2013;mode 1920x1080 &#x2013;scale 1x1 &#x2013;output LVDS-1 &#x2013;mode 1366x768 &#x2013;scale 1x1 &#x2013;left-of VGA-1
</p>

<p>
You can detect the names of your screens by just running xrandr
</p>
</blockquote>

<p>
Adjust brightness from command line:
</p>

<div class="org-src-container">
<pre class="src src-sh">xrandr --output monitor-name --brightness level
</pre>
</div>

<p>
<b><b>Remember</b></b> as mentioned in <code>man xrandr</code>
</p>

<blockquote>
<p>
However, this is a software only  modification,  if  your  hardware  has  support  to  actually change the brightness, you will probably prefer to use xbacklight.
</p>
</blockquote>
</div>
</div>
<div id="outline-container-orga39a7d3" class="outline-4">
<h4 id="orga39a7d3">Wayland / wlr-randr</h4>
<div class="outline-text-4" id="text-orga39a7d3">
<p>
Remember to set <code>WAYLAND_DISPLAY</code> env var before using <code>wlr-randr</code> (usually <code>export WAYLAND_DISPLAY=wayland-1</code>)
</p>

<p>
The commands are almost the same as <code>xrandr</code>; keep in mind the way the screens are handled is different and <code>--same-as</code> option is not available.
</p>
</div>
</div>
</div>
<div id="outline-container-org98e8517" class="outline-3">
<h3 id="org98e8517">Set wallpaper</h3>
<div class="outline-text-3" id="text-org98e8517">
<p>
You can use <a href="https://wiki.archlinux.org/title/Feh"><code>feh</code></a>
</p>

<div class="org-src-container">
<pre class="src src-sh">feh --bg-fill ~/path/to/image.png
</pre>
</div>

<p>
Or you can use the <code>xsetroot</code> utility (usually packaged into <code>xdotool</code>).
Consider xsetroot accepts a particular format of file called <i>bitmap</i> (<code>xsetroot -bitmap bitmap-file.xbm</code>); to convert a file into this format you can use Imagemagick. <b>N.B.</b> the bitmap is not the well-known Windows bitmap format (.bmp) but is the <i>X11 bitmap format</i> (.xbm):
</p>

<div class="org-src-container">
<pre class="src src-sh">convert wallpaper.png wallpaper.xbm
</pre>
</div>
</div>
</div>
<div id="outline-container-org297e74c" class="outline-3">
<h3 id="org297e74c">Set keyboard layout from command-line</h3>
<div class="outline-text-3" id="text-org297e74c">
<div class="org-src-container">
<pre class="src src-sh">setxkbmap -layout us,it
</pre>
</div>
</div>
</div>
<div id="outline-container-org46c8b71" class="outline-3">
<h3 id="org46c8b71">Get and set name/class to an X application (window)</h3>
<div class="outline-text-3" id="text-org46c8b71">
<p>
If the app as been built as GTK+ app it accepts <code>--screen</code>, <code>--name</code>, <code>--class</code> options. It can be used, for instance, by <a href="https://i3wm.org/docs/userguide.html#assign_workspace">i3 rules configuration</a>.
</p>

<p>
To get the window ID use <code>xdotool</code> (ex. <code>xdotool search -class mpv</code>)
</p>
</div>
</div>
<div id="outline-container-org857e043" class="outline-3">
<h3 id="org857e043">Window Manager</h3>
<div class="outline-text-3" id="text-org857e043">
</div>
<div id="outline-container-org17bf5da" class="outline-4">
<h4 id="org17bf5da"><a href="https://i3wm.org/">i3wm</a></h4>
<div class="outline-text-4" id="text-org17bf5da">
<p>
If you, like me, use i3 as your window manager and Emacs as your editor, you might want to make them play nicer together. <a href="emacs/modules.html#orgef5faa0">In this section</a> you can find some emacs packages and an i3 configuration file.
</p>

<ul class="org-ul">
<li><a href="https://thomashunter.name/i3-configurator/">Thomas Hunter's Online Colorscheme Configurator for i3, i3status, dmenu</a></li>
</ul>
</div>
</div>
<div id="outline-container-orga13497c" class="outline-4">
<h4 id="orga13497c"><a href="https://awesomewm.org/">Awesome WM</a></h4>
<div class="outline-text-4" id="text-orga13497c">
<ul class="org-ul">
<li><a href="http://pavelmakhov.com/awesome-wm-widgets/">http://pavelmakhov.com/awesome-wm-widgets/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org1ab6dca" class="outline-3">
<h3 id="org1ab6dca">MPV</h3>
<div class="outline-text-3" id="text-org1ab6dca">
<p>
If you have troubles to hear the audio output when using <code>mvp</code> you shouuld set the <code>--ao</code> flag.
</p>

<div class="org-src-container">
<pre class="src src-sh">mpv --ao=help # to get a list of the available outputs
mpv --ao=pulse file-to-reproduce.mp4
</pre>
</div>

<p>
or set the flag via the configuration file in <code>~/.config/mpv/mpv.conf</code>
</p>

<div class="org-src-container">
<pre class="src src-conf">ao=pulse
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdbc0fbb" class="outline-2">
<h2 id="orgdbc0fbb">MacOS</h2>
<div class="outline-text-2" id="text-orgdbc0fbb">
</div>
<div id="outline-container-orgd7f84f3" class="outline-3">
<h3 id="orgd7f84f3">Install <a href="https://brew.sh/">Homebrew</a></h3>
<div class="outline-text-3" id="text-orgd7f84f3">
<div class="org-src-container">
<pre class="src src-sh">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
</pre>
</div>
</div>
</div>
<div id="outline-container-org3d69e04" class="outline-3">
<h3 id="org3d69e04">Dev environment</h3>
<div class="outline-text-3" id="text-org3d69e04">
<div class="org-src-container">
<pre class="src src-sh">brew install tmux curl wget git asdf cmake libtool
</pre>
</div>
</div>
</div>
<div id="outline-container-orga5f1baf" class="outline-3">
<h3 id="orga5f1baf">Emacs</h3>
<div class="outline-text-3" id="text-orga5f1baf">
<p>
There are many options.
</p>

<ul class="org-ul">
<li>You can use the <a href="https://emacsformacosx.com/">Emacs for Mac OS X</a> bundle, but it is not always up to date to newer versions.</li>
<li>You can install via homebrew</li>
<li>You can install the <a href="https://github.com/d12frosted/homebrew-emacs-plus">Emacs plus</a> via homebrew</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">brew tap d12frosted/emacs-plus
brew install emacs-plus
# or
brew install emacs-plus@29 
</pre>
</div>
</div>
</div>
<div id="outline-container-org7270fa1" class="outline-3">
<h3 id="org7270fa1">Reset DNS cache on Macos</h3>
<div class="outline-text-3" id="text-org7270fa1">
<p>
Taken from <a href="https://www.lifewire.com/flush-dns-cache-on-a-mac-5209298">this article</a>.
</p>

<div class="org-src-container">
<pre class="src src-shell">sudo dscacheutil -flushcache
sudo killall -HUP mDNSResponder
</pre>
</div>
</div>
</div>
<div id="outline-container-org530f6cd" class="outline-3">
<h3 id="org530f6cd">Let QuickPlayer to autoplay on open</h3>
<div class="outline-text-3" id="text-org530f6cd">
<p>
Taken from this <a href="https://osxdaily.com/2009/09/03/autoplay-quicktime-movies-on-open-and-5-other-useful-quicktime-x-hacks/">Osx Daily post</a>. ‚ö†Ô∏è <i>it seems not working on my Mac</i> ü§î 
</p>

<div class="org-src-container">
<pre class="src src-sh">defaults write com.apple.QuickTimePlayerX MGPlayMovieOnOpen 1
</pre>
</div>
</div>
</div>
<div id="outline-container-org7bd2fb7" class="outline-3">
<h3 id="org7bd2fb7">Get my IP address</h3>
<div class="outline-text-3" id="text-org7bd2fb7">
<p>
For wireless: Use <code>ipconfig getifaddr en1</code>.
For ethernet: Useipconfig <code>ipconfig getifaddr en0</code>.
For public IP address: <code>dig -4 TXT +short o-o.myaddr.l.google.com @ns1.google.com</code>.
</p>
</div>
</div>
<div id="outline-container-org54e6139" class="outline-3">
<h3 id="org54e6139">Installing Linux on MacBook Pro</h3>
<div class="outline-text-3" id="text-org54e6139">
</div>
<div id="outline-container-org4dd3ebc" class="outline-4">
<h4 id="org4dd3ebc">Bluetooh issues</h4>
<div class="outline-text-4" id="text-org4dd3ebc">
<p>
Installed this seems to fix.
</p>
<ul class="org-ul">
<li><a href="https://github.com/leifliddy/macbook12-bluetooth-driver">https://github.com/leifliddy/macbook12-bluetooth-driver</a></li>
</ul>

<p>
Bluetooth is not still completely relyable and sometimes I have problems to pair and connect. Probably it's better to search for somethig like <i>mackbook13-bluetooth-driver</i> :D
</p>
</div>
</div>
<div id="outline-container-org30d050c" class="outline-4">
<h4 id="org30d050c">Sound issues</h4>
<div class="outline-text-4" id="text-org30d050c">
<p>
After the install I've noticed the laptop speakers weren't usable. I've googled and and found these repo that seems to fix the issue.
</p>
<ul class="org-ul">
<li><a href="https://github.com/egorenar/snd-hda-codec-cs8409">https://github.com/egorenar/snd-hda-codec-cs8409</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-org200b983" class="outline-2">
<h2 id="org200b983">Makefile</h2>
<div class="outline-text-2" id="text-org200b983">
<ul class="org-ul">
<li><a href="https://makefiletutorial.com/">https://makefiletutorial.com/</a></li>
</ul>

<p>
A sample of makefile usefull for <i>day-to-day</i> development: fetch the remote repo (<code>sync</code>) avoiding to digit the ssh passowrd everytime (<code>sshadd</code>)
</p>

<div class="org-src-container">
<pre class="src src-makefile">sync:
        git fetch
        git pull origin master
sshadd:
        eval `ssh-agent -s`
        ssh-add
asdf-install:
        wget https://github.com/asdf-vm/asdf/releases/download/v0.16.7/asdf-v0.16.7-linux-arm64.tar.gz
        mkdir -p ~/.local/bin
        tar -xf asdf-v0.16.7.linux-arm64.tar.gz -C ~/.local/bin/
elixir-install:
        cd ~/
        asdf plugin add elixir
        asdf plugin add erlang
        sudo apt install libncurses-dev libssl-dev
        asdf install erlang 27.0
        asdf install elixir 1.18-otp-27
        asdf set erlang 27.0
        asdf set elixir 1.18-otp-27
</pre>
</div>

<p>
Here a sample Makefile that uses <i>double dollar sign</i> to assign variables using ENVs. Also notice the use of nested interpolation: you can connect to <code>nas</code> using the command <code>make ssh host=nas</code>.
</p>

<div class="org-src-container">
<pre class="src src-makefile">username := $$USER # &lt;-- uses shell ENV
laptop := 192.168.1.67
nas := 192.168.1.226

default: usage

nas:
          ssh ${username}@${nas}

ssh:
          ssh ${username}@${${host}} # &lt;-- notice the nested interpolation!
usage:
          cat ~/Makefile
</pre>
</div>
</div>
</div>
<div id="outline-container-org5836833" class="outline-2">
<h2 id="org5836833">OpenSource stacks and technologies</h2>
<div class="outline-text-2" id="text-org5836833">
</div>
<div id="outline-container-orgc733375" class="outline-3">
<h3 id="orgc733375">Push notifications</h3>
<div class="outline-text-3" id="text-orgc733375">
<ul class="org-ul">
<li><a href="https://gotify.net/">https://gotify.net/</a></li>
</ul>
</div>
</div>
<div id="outline-container-orga3bed0c" class="outline-3">
<h3 id="orga3bed0c">CI</h3>
<div class="outline-text-3" id="text-orga3bed0c">
<ul class="org-ul">
<li>laminar</li>
</ul>
</div>
</div>
<div id="outline-container-orgdb43e76" class="outline-3">
<h3 id="orgdb43e76"><a href="https://spritely.institute/">Spritely institute</a> - distributed web technology</h3>
</div>
</div>
<div id="outline-container-orgc08bb59" class="outline-2">
<h2 id="orgc08bb59"><a href="https://www.openvoiceos.org/">OpenVoiceOS</a>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="foss">foss</span>&#xa0;<span class="AI">AI</span></span></h2>
</div>
<div id="outline-container-org46447e6" class="outline-2">
<h2 id="org46447e6">Pandoc</h2>
<div class="outline-text-2" id="text-org46447e6">
<p>
Install <b>all</b> packages to manage pdf files
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">apt install pandoc texlive-latex-base texlive-latex-recommended texlive-latex-extra
</pre>
</div>

<p>
Convert a <code>txt</code> file to <code>pdf</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">pandoc file.txt -o file.pdf
</pre>
</div>
</div>
</div>
<div id="outline-container-org6c996fe" class="outline-2">
<h2 id="org6c996fe">Postgres</h2>
<div class="outline-text-2" id="text-org6c996fe">
<p>
How to create an user on Postgres (<a href="https://www.postgresql.org/docs/current/sql-createuser.html">https://www.postgresql.org/docs/current/sql-createuser.html</a>)
</p>

<div class="org-src-container">
<pre class="src src-sql">CREATE USER postgres WITH SUPERUSER PASSWORD 'password';
</pre>
</div>

<p>
Rename a database (<a href="https://www.postgresqltutorial.com/postgresql-administration/postgresql-rename-database/">here</a> the full procedure)
</p>

<div class="org-src-container">
<pre class="src src-sql">ALTER DATABASE db RENAME TO newdb;
</pre>
</div>
</div>
</div>
<div id="outline-container-org3c3788b" class="outline-2">
<h2 id="org3c3788b">Raspberry</h2>
<div class="outline-text-2" id="text-org3c3788b">
</div>
<div id="outline-container-orgcd45638" class="outline-3">
<h3 id="orgcd45638">Projects and Prototyping</h3>
<div class="outline-text-3" id="text-orgcd45638">
<ul class="org-ul">
<li><a href="https://wokwi.com/pi-pico">Raspberry Pi Pico Simulator</a></li>
</ul>
</div>
</div>
<div id="outline-container-org21f2532" class="outline-3">
<h3 id="org21f2532"><a href="https://retropie.org.uk/docs/Overscan/">Overscan</a></h3>
</div>
<div id="outline-container-org257c01f" class="outline-3">
<h3 id="org257c01f">Detect Raspberry model</h3>
<div class="outline-text-3" id="text-org257c01f">
<div class="org-src-container">
<pre class="src src-sh">cat /proc/device-tree/model
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf57aa80" class="outline-3">
<h3 id="orgf57aa80">Linux based OS for Raspberry</h3>
<div class="outline-text-3" id="text-orgf57aa80">
<ul class="org-ul">
<li><a href="https://www.raspberrypi.com/software/">https://www.raspberrypi.com/software/</a></li>
<li><a href="https://github.com/guysoft/CustomPiOS">https://github.com/guysoft/CustomPiOS</a></li>
</ul>
</div>
</div>
<div id="outline-container-org9200be7" class="outline-3">
<h3 id="org9200be7">Deal with I2C from CLI</h3>
<div class="outline-text-3" id="text-org9200be7">
<ul class="org-ul">
<li><a href="https://pi3g.com/enabling-and-checking-i2c-on-the-raspberry-pi-using-the-command-line-for-your-own-scripts/">https://pi3g.com/enabling-and-checking-i2c-on-the-raspberry-pi-using-the-command-line-for-your-own-scripts/</a></li>
</ul>
</div>
</div>
<div id="outline-container-org978a15d" class="outline-3">
<h3 id="org978a15d">Troubleshoot USB Capacitive Touch Screen Display</h3>
<div class="outline-text-3" id="text-org978a15d">
<ul class="org-ul">
<li><a href="https://forums.raspberrypi.com/viewtopic.php?t=116174">https://forums.raspberrypi.com/viewtopic.php?t=116174</a></li>
<li><a href="https://github.com/bsteinsbo/rpi_touch_driver">https://github.com/bsteinsbo/rpi_touch_driver</a></li>
<li><a href="https://learn.adafruit.com/adafruit-pitft-28-inch-resistive-touchscreen-display-raspberry-pi/easy-install-2">Connect Adafruit PiTFT on Raspberry Pi 3 - 320x240 2.8" TFT+Touchscreen on Raspberry Pi3</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">sudo apt-get update
sudo apt install python3-venv
python -m venv env --system-site-packages

cd ~
source env/bin/activate

sudo apt-get install -y git python3-pip
pip3 install --upgrade adafruit-python-shell click
git clone https://github.com/adafruit/Raspberry-Pi-Installer-Scripts.git
cd Raspberry-Pi-Installer-Scripts

sudo -E env PATH=$PATH python3 adafruit-pitft.py
</pre>
</div>

<p>
Then check in <code>/usr/share/X11/xorg.conf.d/</code> for a <i>calibration</i> init file and tweak the <code>SwapXY</code> or <code>InvertX</code> / <code>InvertY</code> options.
If there are issues about the touchscreen which does not move the pointer where you click on the screen, consider using the <code>evdev</code> driver as proposed in <a href="https://forums.adafruit.com/viewtopic.php?f=50&amp;t=111045">this forum</a>:
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo apt-get install xserver-xorg-input-evdev
</pre>
</div>

<p>
If you do have a 40-libinput.conf in that same directory, you must remove it even if/once evdev is installed, since it will override the 10-evdev.conf otherwise.
</p>
</div>
</div>
<div id="outline-container-orgcb6d62c" class="outline-3">
<h3 id="orgcb6d62c">Use Raspberry Pi in "Kiosk" mode</h3>
<div class="outline-text-3" id="text-orgcb6d62c">
<ul class="org-ul">
<li><a href="https://github.com/elalemanyo/raspberry-pi-kiosk-screen">https://github.com/elalemanyo/raspberry-pi-kiosk-screen</a></li>
</ul>
</div>
<div id="outline-container-org9f5cba5" class="outline-4">
<h4 id="org9f5cba5"><a href="kiosk.html">Use Emacs as Kiosk</a></h4>
</div>
<div id="outline-container-org642f86e" class="outline-4">
<h4 id="org642f86e">Darbula (Elixir/Phoenix)</h4>
<div class="outline-text-4" id="text-org642f86e">
<p>
Install Elixir on Raspberry/Raspbian (source article <a href="https://erlangsolutions.medium.com/installing-elixir-on-a-raspberry-pi-the-easy-way-22f347a77e2c">here</a>).
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo apt-get update &amp;&amp; sudo apt-get install erlang erlang-dev elixir
</pre>
</div>
</div>
</div>
<div id="outline-container-org0fb88dd" class="outline-4">
<h4 id="org0fb88dd">Useful software</h4>
<div class="outline-text-4" id="text-org0fb88dd">
<div class="org-src-container">
<pre class="src src-sh">sudo apt install xdotool wget git curl emacs tmux
</pre>
</div>
</div>
</div>
<div id="outline-container-orgef778f8" class="outline-4">
<h4 id="orgef778f8">Useful Makefile</h4>
<div class="outline-text-4" id="text-orgef778f8">
<div class="org-src-container">
<pre class="src src-makefile">default: usage
x-dual-adjacent:
        DISPLAY=:0 xrandr --output HDMI-1 --primary --mode 1920x1080 --output DSI-1 --mode 800x480 --right-of HDMI-1
x-dual:
        DISPLAY=:0 xrandr --output HDMI-1 --primary --mode 1920x1080 --output DSI-1 --mode 800x480
x-mirror:
        DISPLAY=:0 xrandr --output HDMI-1 --primary --mode 1920x1080 --output DSI-1 --mode 800x480 --scale 2.2 --same-as HDMI-1
spy-audio-live:
        cvlc -vvv alsa://plughw:3 --sout '#transcode{acodec=mp3,ab=64,channels=1}:standard{access=http,dst=0.0.0.0:8888/out.mp3}'
spy-audio-rec:
        arecord -d 4 -f dat spy.wav
usage:
        cat Makefile
pitft-install:
        sudo -E env PATH=$PATH python3 adafruit-pitft.py --display=28r --rotation=90 --install-type=mirror
pitft-calibrate:
        TSLIB_FBDEVICE=/dev/fb1 TSLIB_TSDEVICE=/dev/input/touchscreen ts_calibrate -c -r 0
</pre>
</div>
</div>
</div>
<div id="outline-container-org7177016" class="outline-4">
<h4 id="org7177016">Browsers</h4>
<div class="outline-text-4" id="text-org7177016">
<p>
Using Chromium and Firefox as browser works well only on RPi &gt; 1, otherwise you end up with an error message.
</p>

<p>
I've tried some browser in order to achieve the best <i>kiosk</i> like experience. Some of them have the ad-hoc <code>kiosk</code> flag to pass at the command line and that's cool. But I also found some issues. Here's a quick recap:
</p>
<ul class="org-ul">
<li><a href="#org5e09f0c">Chromium</a>: it has a very good <code>--app</code> flag (which operates almost like <code>--kiosk</code> flag, which is deprecated); unfortunately for some reason I haven't investigated in depth, it seems it does not work well with websocket; I've launched an Elixir/Phoenix Liveview webapp and all interactions via the websocket are dramatically delayed (maybe it fallbacks in the <code>longpoll</code> mode).</li>
<li>Firefox: it does not arise the issue of the websocket I had with Chromium, but on a really small screen (320x240) it does not fit well: it presents an overlfow of the container. I've found <a href="https://stackoverflow.com/questions/7663005/is-firefox-6-7-handling-max-width320px-media-query-wrong">a thread that confirms that issue</a>, but I haven't spent time trying to solve it.</li>
<li>Epiphany: it does not have any <code>--kiosk</code> not event <code>--fullscreen</code> flag, so you have to set the fullscreen by scripting around via <code>xdotool</code>, <code>xte</code> or tools like that. This is really annoying.</li>
<li><a href="#orgc2a8d31">Luakit</a>: it does not have toolbars or annoying stuff by default, so basically it already comes in <i>kiosk</i> mode. It handles websocket connections with no issues. I've ended up with this fantastic piece of software.</li>
</ul>

<p>
Related sources:
</p>
<ul class="org-ul">
<li><a href="https://forums.raspberrypi.com/viewtopic.php?t=336486">Pi0, Single web page Kiosk. Which lightweight browser?</a></li>
</ul>
</div>
<ul class="org-ul">
<li><a id="org5e09f0c"></a>Chromium<br />
<div class="outline-text-6" id="text-org5e09f0c">
<p>
Start Chromium in Kiosk mode within Wayland.
</p>

<div class="org-src-container">
<pre class="src src-sh">XDG_RUNTIME_DIR=/run/user/1000 WAYLAND_DISPLAY=wayland-1 chromium-browser --kiosk --noerrdialogs --disable-infobars --no-first-run --ozone-platform=wayland --enable-features=OverlayScrollbar --start-maximized --no-touch-pinch --disable-pinch http://localhost:4000/
</pre>
</div>

<p>
Start Chromium in Kiosk mode within X11.
</p>

<div class="org-src-container">
<pre class="src src-sh">DISPLAY=:0 chromium-browser --kiosk --noerrdialogs --disable-infobars --no-first-run --ozone-platform=x11 --enable-features=OverlayScrollbar --start-maximized --no-touch-pinch --disable-pinch http://localhost:4000/
</pre>
</div>

<p>
or
</p>

<div class="org-src-container">
<pre class="src src-sh">DISPLAY=:0 chromium-browser --kiosk --touch-events=enabled --disable-pinch --noerrdialogs --disable-session-crashed-bubble --simulate-outdated-n\
o-au='Tue, 31 Dec 2099 23:59:59 GMT' --disable-web-security --allow-running-insecure-content --disable-component-update --overscroll-history-navig\
ation=0 --disable-features=Translate --app=http://localhost:4000 
</pre>
</div>

<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/22999829/disable-chrome-pinch-zoom-for-use-in-kiosk">Disable Chrome pinch zoom for use in kiosk</a></li>
</ul>

<p>
This script is taken from the <a href="https://www.otot.tv/fullpageos/">FullPageOS</a> and is used to start chromium.
</p>

<p>
#+begin<sub>src</sub> sh
  #!/bin/bash
</p>

<p>
chromium-browser &#x2013;kiosk &#x2013;touch-events=enabled &#x2013;disable-pinch &#x2013;noerrdialogs &#x2013;disable-session-crashed-bubble &#x2013;simulate-outdated-no-au='Tue, 31 Dec 2099 23:59:59 GMT' &#x2013;disable-component-update &#x2013;overscroll-history-navigation=0 &#x2013;disable-features=Translate &#x2013;app=$(/home/pi/scripts/get<sub>url</sub>)
exit;
</p>

<p>
chromium-browser &#x2013;enable-logging &#x2013;log-level=2 &#x2013;v=0 &#x2013;kiosk &#x2013;touch-events=enabled &#x2013;disable-pinch &#x2013;noerrdialogs &#x2013;simulate-outdated-no-au='Tue, 31 Dec 2099 23:59:59 GMT' &#x2013;disable-session-crashed-bubble &#x2013;disable-component-update &#x2013;overscroll-history-navigation=0 &#x2013;disable-features=Translate &#x2013;app=\((head -n 1 /boot/fullpageos.txt | sed -e "s/{serial}/\){SERIAL}/g") &amp;
</p>

<p>
export logfile="<i>home/pi</i>.config/chromium/chrome<sub>debug.log</sub>"
</p>


<p>
tail -n 0 -F "$logfile" | while read LOGLINE &amp;&gt; /dev/null; do
</p>

<p>
echo "Refreshing after crash"
echo "Restarting at `date` after a reported crash. Logline: \({LOGLINE}" >> /tmp/crashlog
     [[ ("\){LOGLINE}" <code>= *"ERROR"*) || ("${LOGLINE}" =</code> <b>"FATAL"</b>) ]] &amp;&amp; /home/pi/scripts/refresh
</p>

<p>
done#+end<sub>src</sub>
</p>
</div>
</li>
<li><a id="org11f0b80"></a>Old RPi models<br />
<div class="outline-text-6" id="text-org11f0b80">
<p>
For old devices (RPi 1) Midori browser looks promising. The only problem is the <code>e jump-to</code> command that opens a new browser window insterad of "jump" the existing one. This issue can be solved on application side (just reload the same URL endpoint, displaying different contents).
</p>

<p>
P.S. Epiphany: it has interesting options like <code>automation-mode</code> but didn't have the time to inspect more.
</p>
</div>
</li>
<li><a id="orgc2a8d31"></a><a href="https://luakit.github.io/">Luakit</a><br />
<div class="outline-text-6" id="text-orgc2a8d31">
<p>
To start Luakit in fullscreen mode adds this snippet in the <code>~/.config/luakit/rc.lua</code> (if this file is empty you can grab the default configuration file via <code>cp /etc/xdg/luakit/rc.lua ~/.config/luakit/</code>)
</p>

<div class="org-src-container">
<pre class="src src-lua">window.add_signal("init", function (w)
  w.win.fullscreen = true
end)
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-orga5457ff" class="outline-4">
<h4 id="orga5457ff">System setup</h4>
<div class="outline-text-4" id="text-orga5457ff">
</div>
<ul class="org-ul">
<li><a id="org4a5465a"></a>Screen setup<br />
<ul class="org-ul">
<li><a id="org74f2615"></a>Wayland vs X11<br />
<div class="outline-text-6" id="text-org74f2615">
<p>
With Wayland I've encountered many troubles trying to manage the monitors (TV + touchscreen) via command line tools (<code>wlr-randr</code>); it handles the virtual monitor in a different way and it lacks handy options like <code>--same-as</code>. For this reason I've decided to temporary drop Wayland in favor of the good old X11.
I've used <code>raspi-config</code> in order to use the standard <code>X11</code> server.
</p>

<p>
In order to have the same contents both on TV and the touchscreen I've used <code>xrandr</code> to mirror the output in almost the same layout
</p>

<div class="org-src-container">
<pre class="src src-sh">xrandr --output HDMI-1 --primary --mode 1920x1080 --output DSI-1 --mode 800x480 --scale 2.2 --same-as HDMI-1
</pre>
</div>
</div>
</li>
<li><a id="org91996ff"></a>Window manager<br />
<div class="outline-text-6" id="text-org91996ff">
<p>
Even if the main purpose of the <i>Kiosk</i> is to display a browser window in fullscreen mode (or kiosk mode, if the browser supports it), and since I do most of the operations on the Raspberry via SSH, I could leave the default LXDE window manager. But since I've two monitors, I'd like to take advantage and use both of them in different way instad of just replicate the same contents. Since I've no mouse, I want to launch apps and have them to be arranged automatically via <b>rules</b>. I don't want to investigate LXDE configuration files, or if it can be achieved via some XDG files: I use i3 every day and it allow to span windows across workspaces (and screens) by defining simple rules. For this reason I'll install i3 and I'll configure the system to auto-login in a i3 session.
</p>

<p>
<b>N.B.</b> At the time of writing I was able to install and setup i3, but I haven't defined any rules yet, even because I've to decide how to use the touchscreen. 
</p>

<ol class="org-ol">
<li><code>sudo apt install i3</code></li>
<li>update LightDM conf (<code>/etc/lightdm/lightdm.conf</code>) in order to set the
<code>autologin-session</code> to <code>i3</code></li>
<li><code>sudo update-alternatives --config x-session-manager</code> and <code>sudo update-alternatives --config x-window-manager</code> and set i3</li>
</ol>

<p>
I'm not sure the step <b>3</b> is really needed, I'll investigate more later. You also probably have to check if there's a file in <code>/usr/share/xsessions/</code> (check <a href="dev.html#org7bf3e10">here</a> for more details)
</p>
</div>
</li>
</ul>
</li>
<li><a id="org9f0f9b8"></a>Setup PulseAudio<br />
<div class="outline-text-5" id="text-org9f0f9b8">
<p>
Due to the troubles about Wayland, I've decided to switched back to PulseAudio instead of PipeWire. Since the Raspberry case does not have any speaker, I want to reproduce the sounds via the TV (HDMI). In order to do that I had to set the PulseAudio default sink to the HDMI card device:
</p>

<ol class="org-ol">
<li>get the device index via</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">pacmd list-sinks
</pre>
</div>

<p>
the current default sink has an asterisk near the index.
</p>

<div class="org-src-container">
<pre class="src src-nil">index: 1
  name: &lt;alsa_output.platform-fef00700.hdmi.hdmi-stereo&gt;
  driver: &lt;module-alsa-card.c&gt;
</pre>
</div>

<ol class="org-ol">
<li>find the index of the HDMI device and use it (assume it's <code>1</code>)</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">pacmd set-default-sink 1
</pre>
</div>

<p>
To verify I rerun <code>pacmd list-sinks</code> and check for the <code>*</code>.
</p>

<div class="org-src-container">
<pre class="src src-nil">* index: 1
      name: &lt;alsa_output.platform-fef00700.hdmi.hdmi-stereo&gt;
      driver: &lt;module-alsa-card.c&gt;
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgd4ffe9b" class="outline-4">
<h4 id="orgd4ffe9b">MPV + Youtube</h4>
<div class="outline-text-4" id="text-orgd4ffe9b">
<p>
It could be userful to add the flag <code>--ytdl-raw-options=cookies-from-browser=chromium</code>. Also set <code>bongo-custom-backend-matchers</code> to include also <code>https</code> protocol. Ensure the Emacs process has the <code>DISPLAY</code> env correctly set in order to display the video!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package bongo
  :custom
  (bongo-enabled-backends '(mpv))
  (bongo-custom-backend-matchers '((mpv ("https:") . t)))
  (bongo-mpv-extra-arguments '("--no-audio-display" "--ytdl-raw-options=cookies-from-browser=chromium")))
</pre>
</div>
</div>
</div>
<div id="outline-container-org9255521" class="outline-4">
<h4 id="org9255521">Simulate keyboard events</h4>
<div class="outline-text-4" id="text-org9255521">
<ul class="org-ul">
<li>Send keys to the graphic server
X (<a href="https://github.com/jordansissel/xdotool">xdotool</a>): <code>xdotool key ctrl+l</code> or <code>xdotool type "Hello world"</code>
Wayland: <code>XDG_RUNTIME_DIR=/run/user/1000 wtype -M ctrl -P Tab -m ctrl -p Tab</code></li>
</ul>
</div>
</div>
<div id="outline-container-orge051aa8" class="outline-4">
<h4 id="orge051aa8">Resources</h4>
<div class="outline-text-4" id="text-orge051aa8">
<ul class="org-ul">
<li><a href="http://simplyautomationized.blogspot.com/2015/04/rpicframe-html5-kiosk-style-picture.html">http://simplyautomationized.blogspot.com/2015/04/rpicframe-html5-kiosk-style-picture.html</a></li>
<li><a href="https://www.raspberrypi.com/tutorials/how-to-use-a-raspberry-pi-in-kiosk-mode/">https://www.raspberrypi.com/tutorials/how-to-use-a-raspberry-pi-in-kiosk-mode/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org6e6c47f" class="outline-3">
<h3 id="org6e6c47f">How to attach a cooler fan</h3>
<div class="outline-text-3" id="text-org6e6c47f">
<ul class="org-ul">
<li><a href="https://www.freva.com/connecting-a-fan-to-a-raspberry-pi/?srsltid=AfmBOorgZc90NP9RgfctZKWpl-V6XJtozQjo7NU8pU_Lr1S_9rTWGVJv">https://www.freva.com/connecting-a-fan-to-a-raspberry-pi/?srsltid=AfmBOorgZc90NP9RgfctZKWpl-V6XJtozQjo7NU8pU_Lr1S_9rTWGVJv</a></li>
</ul>
</div>
</div>
<div id="outline-container-orga442aec" class="outline-3">
<h3 id="orga442aec"><a href="https://www.raspberrypi.com/tutorials/how-to-build-a-super-slim-smart-mirror/">Magic Mirror</a></h3>
</div>
<div id="outline-container-orgb29517d" class="outline-3">
<h3 id="orgb29517d"><a href="https://raspberrypi-guide.github.io/electronics/using-usb-webcams">Working with USB webcams on your Raspberry Pi</a></h3>
</div>
<div id="outline-container-org02d9175" class="outline-3">
<h3 id="org02d9175">Turn your RPi into a Spy</h3>
<div class="outline-text-3" id="text-org02d9175">
<p>
Use <a href="https://motion-project.github.io/">motion</a> app; <a href="https://www.instructables.com/How-to-Make-Raspberry-Pi-Webcam-Server-and-Stream-/">Here's a detailed article: How to Make Raspberry Pi Webcam Server and Stream</a>.
</p>
</div>
</div>
<div id="outline-container-orgaddcf51" class="outline-3">
<h3 id="orgaddcf51">Turn your RPi into a Spy (audio)</h3>
<div class="outline-text-3" id="text-orgaddcf51">
<p>
I want to use the mic of the Raspberry to stream on the audio over the network.
I've achieved by following the instructions in this blogpost: <a href="https://hobbylad.wordpress.com/2017/04/26/raspberry-pi-system-audio-redirection-over-network/">Stream audio over the network using VLC</a>.
To detect the alsa card for recording use <code>arecord -l</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">card 3: Device [USB PnP Sound Device], device 0: USB Audio [USB Audio]
  Subdevices: 1/1
  Subdevice #0: subdevice #0
</pre>
</div>

<p>
then stream using VLC
</p>

<div class="org-src-container">
<pre class="src src-sh">cvlc -vvv alsa://plughw:3 --sout '#transcode{acodec=mp3,ab=64,channels=1}:standard{access=http,dst=0.0.0.0:8888/out.mp3}'
</pre>
</div>

<p>
Connect to the raspberry: if the IP address is, for instance, 192.168.1.44, go to <a href="http://192.168.1.44:8888/out.mp3">http://192.168.1.44:8888/out.mp3</a>.
</p>

<p>
If you're not interested in streaming but just record the audio onto a file start recording using <code>arecord</code> for 4 seconds in <i>dat</i> format (16bit; see man for more options):
</p>

<div class="org-src-container">
<pre class="src src-shell">arecord -d 4 -f dat spy.wav
</pre>
</div>

<p>
Other resources:
</p>
<ul class="org-ul">
<li><a href="https://community.element14.com/challenges-projects/project14/spynerd/b/blog/posts/pi-spy-audio-recorder---part-1">https://community.element14.com/challenges-projects/project14/spynerd/b/blog/posts/pi-spy-audio-recorder---part-1</a></li>
</ul>
</div>
</div>
<div id="outline-container-org31d14f5" class="outline-3">
<h3 id="org31d14f5">Turn your RPi into an Access Point</h3>
<div class="outline-text-3" id="text-org31d14f5">
<p>
<a href="https://raspberrytips.com/access-point-setup-raspberry-pi/">https://raspberrytips.com/access-point-setup-raspberry-pi/</a>
</p>
</div>
</div>
</div>
<div id="outline-container-orgce99817" class="outline-2">
<h2 id="orgce99817">Shell</h2>
<div class="outline-text-2" id="text-orgce99817">
<p>
My <code>.zprofile</code> on my Mackbook.
</p>

<div class="org-src-container">
<pre class="src src-sh">eval "$(/usr/local/bin/brew shellenv)"
eval "$(fzf --bash)"
export ASDF_DIR="$HOME/.asdf"
. "$HOME/.asdf/asdf.sh"
. "$HOME/.asdf/completions/asdf.bash"
export PATH=~/.local/bin:$PATH
alias e='emacs -nw --init-directory=~/.emacs.d.minemacs'
alias t='tmux attach'
</pre>
</div>
</div>
</div>
<div id="outline-container-org6299deb" class="outline-2">
<h2 id="org6299deb">Simple Static assets web server ~ Busybox</h2>
<div class="outline-text-2" id="text-org6299deb">
<p>
Taken from <a href="https://lipanski.com/posts/smallest-docker-image-static-website">this blogpost</a>.
</p>

<div class="org-src-container">
<pre class="src src-dockerfile">FROM busybox:1.35

# Create a non-root user to own the files and run our server
RUN adduser -D static
USER static
WORKDIR /home/static
VOLUME /home/static
EXPOSE 3000

# Copy the static website
# Use the .dockerignore file to control what ends up inside the image!

# Run BusyBox httpd
CMD ["busybox", "httpd", "-f", "-v", "-p", "3000"]
</pre>
</div>

<p>
Create the image
</p>

<div class="org-src-container">
<pre class="src src-sh">cd
docker build -t busybox:1.3.5 -f busybox.dockerfile .
</pre>
</div>

<p>
Start the container (the fullpath is required on MacOS docker installations, if I recall correctly.. ü§î)
</p>

<div class="org-src-container">
<pre class="src src-sh">docker run -d --rm --name file-server --init -p 3000:3000 --volume=/absolute/path/to/your/local/busybox:/home/static busybox:1.3.5
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html">&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;Hei there!&lt;/body&gt;&lt;/html&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org806982b" class="outline-2">
<h2 id="org806982b">Suspend the system via command line</h2>
<div class="outline-text-2" id="text-org806982b">
<p>
Here's a <a href="https://askubuntu.com/questions/1792/how-can-i-suspend-hibernate-from-command-line">StackOverflow thread</a>: <code>systemctl suspend|hibernate</code> (for newest distros) or <code>pmi action suspend|hibernate</code> (old method).
</p>
</div>
</div>
<div id="outline-container-org9684e06" class="outline-2">
<h2 id="org9684e06">Systemd</h2>
<div class="outline-text-2" id="text-org9684e06">
</div>
<div id="outline-container-org09004c1" class="outline-3">
<h3 id="org09004c1">Services definition</h3>
<div class="outline-text-3" id="text-org09004c1">
<p>
Add a service to systemd (more info <a href="https://learn.sparkfun.com/tutorials/how-to-run-a-raspberry-pi-program-on-startup/all">here</a>, while here's an article on how to create and manage <a href="https://www.baeldung.com/linux/systemd-create-user-services">user‚Äôs services With systemd</a>).
</p>

<p>
Create <code>/lib/systemd/system/blink.service</code> (or <code>/lib/systemd/user/blink.service</code> in case of user-space app) with
</p>

<div class="org-src-container">
<pre class="src src-toml">[Unit]
Description=Blink my LED
After=multi-user.target

[Service]
Environment="MY_SHELL_ENV_VAR=value"
ExecStart=/usr/bin/python3 /home/pi/blink.py

[Install]
WantedBy=multi-user.target
</pre>
</div>

<p>
Then start with <code>systemctl [--user] (enable|restart|start|stop) blink</code>
</p>

<p>
To start a service after a specific timeout (ex. 30 seconds) add:
</p>

<div class="org-src-container">
<pre class="src src-toml">[Service]
ExecStartPre=/bin/sleep 30
</pre>
</div>

<p>
To establish an order or requirements across services there are the <code>Wants / Requires/ After</code> options. See <a href="https://serverfault.com/questions/1053369/systemd-how-to-start-service-after-another-service-started">this thread</a> for more details.
</p>
</div>
</div>
<div id="outline-container-org5329864" class="outline-3">
<h3 id="org5329864">Journalctl</h3>
<div class="outline-text-3" id="text-org5329864">
<p>
Clear journalctl: the self maintenance method is to vacuum the logs by size or time. Retain only the past two days:
</p>

<div class="org-src-container">
<pre class="src src-sh">journalctl --vacuum-time=2d
</pre>
</div>

<p>
or retain only the past 500 MB
</p>

<div class="org-src-container">
<pre class="src src-sh">journalctl --vacuum-size=500M
</pre>
</div>

<p>
To print last 40 entries for a particular service (i.e. <i>unit</i>) and keeps following the logs:
</p>

<div class="org-src-container">
<pre class="src src-sh">journalctl -n 40 -u my-service -f
</pre>
</div>
</div>
</div>
<div id="outline-container-org180faa6" class="outline-3">
<h3 id="org180faa6">Environment variables</h3>
<div class="outline-text-3" id="text-org180faa6">
<p>
To set an environment variables when launching a service (more details in <a href="https://serverfault.com/questions/413397/how-to-set-environment-variable-in-systemd-service">this SO thread</a>) <code>systemctl edit myservice</code>. This will create a conf file at <code>/etc/systemd/system/myservice.service.d/myenv.conf</code> or <code>~/.config/systemd/user/emacs.service.d/override.conf</code> if you use the <code>--user</code> flag. Then add envs like this:
</p>

<div class="org-src-container">
<pre class="src src-conf">[Service]
Environment="SECRET=pGNqduRFkB4K9C2vijOmUDa2kPtUhArN"
Environment="ANOTHER_SECRET=JP8YLOc2bsNlrGuD6LVTq7L36obpjzxd"
</pre>
</div>
</div>
</div>
<div id="outline-container-org2de807f" class="outline-3">
<h3 id="org2de807f">Troubleshooting</h3>
<div class="outline-text-3" id="text-org2de807f">
<p>
Sometimes you end up by having some services to start and immediately stop (for instance <code>my-daemon.service Deactivated successfully</code>). I've found the solution to in this <a href="https://superuser.com/questions/1022142/why-is-systemd-stopping-service-immediately-after-it-is-started">StackOverlow thread</a>: you have to specify the <code>Type</code>!
</p>
</div>
</div>
</div>
<div id="outline-container-orgc0b011e" class="outline-2">
<h2 id="orgc0b011e">Tailwind</h2>
<div class="outline-text-2" id="text-orgc0b011e">
<p>
CDN installation:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;meta charset="UTF-8"&gt;
&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org6117f71" class="outline-2">
<h2 id="org6117f71"><a href="https://termux.dev/en/">Termux</a></h2>
<div class="outline-text-2" id="text-org6117f71">
<p>
Termux is an Android terminal emulator and Linux environment application.
</p>

<ul class="org-ul">
<li><a href="https://wiki.termux.com/wiki/Termux:API">https://wiki.termux.com/wiki/Termux:API</a></li>
<li><a href="https://github.com/termux/termux-widget">https://github.com/termux/termux-widget</a></li>
</ul>
</div>
</div>
<div id="outline-container-org0ed77be" class="outline-2">
<h2 id="org0ed77be">Tmux</h2>
<div class="outline-text-2" id="text-org0ed77be">
<p>
Some sources about <code>tmux</code> configuration (<code>~/.tmux.conf</code>)
</p>

<ul class="org-ul">
<li><a href="https://hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/">https://hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/</a></li>
<li><a href="https://gist.github.com/andreyvit/2921703">https://gist.github.com/andreyvit/2921703</a></li>
</ul>

<p>
Super simple, basic configuration using <a href="https://github.com/tmux-plugins/tpm/">TPM</a> and <a href="https://github.com/junegunn/fzf">FZF</a>. For a list of ANSI 256 color names you can take a look at <a href="https://hexdocs.pm/color_palette/ansi_color_codes.html">this link</a>.
</p>

<div class="org-src-container">
<pre class="src src-conf">set -g status-keys emacs

set -g prefix C-h
unbind-key C-b
bind-key C-h send-prefix

bind-key R source ~/.config/tmux/tmux.conf
bind-key -n C-[ previous-window
bind-key -n C-] next-window

set -g default-terminal "screen-256color"
set -g status-bg "#00d75f"
set -g status-fg black

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'sainnhe/tmux-fzf'

# Tmux env configuration
TMUX_FZF_LAUNCH_KEY="C-h"
TMUX_FZF_MENU=\
"files\nls -lh\n"

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'github_username/plugin_name#branch'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'
</pre>
</div>

<p>
To install the packages <code>prefix+I</code>.
</p>
</div>
</div>
<div id="outline-container-orge2dd4e3" class="outline-2">
<h2 id="orge2dd4e3">Tor</h2>
<div class="outline-text-2" id="text-orge2dd4e3">
</div>
<div id="outline-container-orge9a9790" class="outline-3">
<h3 id="orge9a9790"><a href="https://hub.docker.com/r/dperson/torproxy/">Use Tor proxy via Docker</a></h3>
<div class="outline-text-3" id="text-orge9a9790">
<p>
Use <code>dockage/tor-privoxy:latest</code> image or <code>dperson/torproxy</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo docker run -it -p 8118:8118 -p 9050:9050 -d dperson/torproxy
</pre>
</div>

<p>
then verify you're using the tor proxy connecting to <a href="https://check.torproject.org/">https://check.torproject.org/</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">curl -Lx http://localhost:8118 https://check.torproject.org/ | grep "Congratulations"
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org1549d55" class="outline-2">
<h2 id="org1549d55">Userscripts</h2>
<div class="outline-text-2" id="text-org1549d55">
</div>
<div id="outline-container-orge0989e8" class="outline-3">
<h3 id="orge0989e8">How to store data on a file using Greasemonkey</h3>
<div class="outline-text-3" id="text-orge0989e8">
<p>
More details in this <a href="https://stackoverflow.com/questions/6392103/storing-into-file-using-javascript-greasemonkey/64500313#64500313">StackOverflow thread</a> showing different approaches, here I'm reporting just one.
</p>

<pre class="example" id="org6d7c5d2">
// @grant        GM_download

function saveData(data, filename) {
    const blob = new Blob([data], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    GM_download({
	  url: url,
	  name: filename,
	  saveAs: false,
    });
}

saveData("hello world", "hello.txt");
</pre>
</div>
</div>
</div>
<div id="outline-container-org6168650" class="outline-2">
<h2 id="org6168650">Web browsing/crawling</h2>
<div class="outline-text-2" id="text-org6168650">
</div>
<div id="outline-container-org7e7e5de" class="outline-3">
<h3 id="org7e7e5de">Get the DOM of a webpage using chrome via command-line.</h3>
<div class="outline-text-3" id="text-org7e7e5de">
<div class="org-src-container">
<pre class="src src-sh">chrome --headless --dump-dom https://developer.chrome.com/
</pre>
</div>
</div>
</div>
<div id="outline-container-org539bf5e" class="outline-3">
<h3 id="org539bf5e">Fetch a page via a nodejs app</h3>
<div class="outline-text-3" id="text-org539bf5e">
<p>
Inspiration (and code stolen ü§™) from <a href="https://medium.com/@spencer.canner/downloading-a-webpage-using-node-js-8ba71ff58d6e">this Medium article</a> (errr&#x2026; <a href="https://freedium.cfd/">Freedium</a> üòé)
</p>

<p>
This is useful when you try to download a web page that does not display some contents if the browser agent you're using does not exec any js code (i.e EWW).
</p>

<ol class="org-ol">
<li>setup a new nodejs project <code>mkdir html-fetch &amp;&amp; node init --yes</code></li>
<li>add <code>node-fetch</code> dependency into the <code>package.json</code> and <code>npm install</code></li>
<li>create the <code>index.js</code> source file with the content as follow:</li>
</ol>

<div class="org-src-container">
<pre class="src src-javascript">const fetch = require("node-fetch");
const fs = require("fs");
// you can update this to any website you want to download
const site = "https://www.youtube.com/@BorderNightsOfficial";
// you can update this if you want to save
const filename = "index.html";
// fetch url
fetch(site, {
  headers: {
    // some sites require a user-agent header to return the webpage
    "User-Agent":
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:97.0) Gecko/20100"},
}).then((res) =&gt; {
  // get text from Response stream
  return res.text();
}).then((text) =&gt; {
  // write html from response to index.html
  fs.writeFile(filename, text, () =&gt; {});
});
</pre>
</div>

<p>
Run it via <code>node index.js</code>. This will fetch the page into the <code>index.html</code> file.
</p>
</div>
</div>
</div>
<div id="outline-container-org267ff4b" class="outline-2">
<h2 id="org267ff4b">Web Resources</h2>
<div class="outline-text-2" id="text-org267ff4b">
<ul class="org-ul">
<li><a href="https://www.instructables.com/">https://www.instructables.com/</a></li>
</ul>
</div>
</div>
<div id="outline-container-org1d4101f" class="outline-2">
<h2 id="org1d4101f">Youtube</h2>
<div class="outline-text-2" id="text-org1d4101f">
</div>
<div id="outline-container-orgc0d9659" class="outline-3">
<h3 id="orgc0d9659">Get the list of subscriptions (followed channels)</h3>
<div class="outline-text-3" id="text-orgc0d9659">
<p>
Go the <a href="https://www.youtube.com/feed/channels">"Manage subscription" page</a>, open the Web Inspector of the browser and execute the snippet below in the JS console; <b>N.B.</b> ensure you've loaded all the entries by scrolling down to the very end of the page.
</p>

<div class="org-src-container">
<pre class="src src-javascript">var channelList = [];
[...document.querySelectorAll('a#main-link.channel-link')].forEach(el =&gt; {
  const channelId = el.getAttribute("href");
  channelList.push((`https://www.youtube.com${channelId}`));
});
console.log(channelList.join("\n"));
</pre>
</div>
</div>
</div>
<div id="outline-container-org46da176" class="outline-3">
<h3 id="org46da176">Get RSS feed of a channel or playlist</h3>
<div class="outline-text-3" id="text-org46da176">
<p>
Get the Channel ID of a Youtube channel (manual approach): <a href="https://www.youtube.com/watch?v=zNABOcxGkt8&amp;t=0s">here</a> a video explaining how to do that. You can ease the process using by copy/pasting this snippet into the Dev console (if the browser allows you that)
</p>

<div class="org-src-container">
<pre class="src src-javascript">alert(document.querySelector("link[itemprop='url']").href);
</pre>
</div>

<p>
then construct as follow:
</p>

<p>
<code>https://youtube.com/watch?v=CHANNEL-ID</code> to <code>https://www.youtube.com/feeds/videos.xml?channel_id=CHANNEL-ID</code>
</p>

<p>
I made some experiments to automate this process:
</p>
<ul class="org-ul">
<li>a sample NodeJS project (see <a href="#org539bf5e">this section</a>)</li>
<li>using <a href="emacs/modules.html#org3ddf1b2">ad-hoc Emacs function</a></li>
</ul>
</div>
</div>
<div id="outline-container-org3fdb993" class="outline-3">
<h3 id="org3fdb993">Youtube downloader (yt-dlp)</h3>
<div class="outline-text-3" id="text-org3fdb993">
</div>
<div id="outline-container-orgc68367d" class="outline-4">
<h4 id="orgc68367d">Usage examples</h4>
<div class="outline-text-4" id="text-orgc68367d">
<p>
Search for videos.
</p>

<div class="org-src-container">
<pre class="src src-sh">yt-dlp ytsearch10:lebron james --get-id --get-title
</pre>
</div>

<p>
Download a list of videos from a file.
</p>

<div class="org-src-container">
<pre class="src src-sh">yt-dlp -a list.txt
</pre>
</div>

<p>
Download a video from services like FB, Instagram or others by using the cookies from our browser in order to access credentials.
</p>

<div class="org-src-container">
<pre class="src src-sh">yt-dlp --cookies-from-browser opera https://www.instagram.com/reel/DBG9t4XCteu/?igsh=d3RpNWZxMnVhenVw
</pre>
</div>

<p>
Download portions of youtube video
</p>

<div class="org-src-container">
<pre class="src src-shell">youtube-dl --postprocessor-args "-ss 00:01:00 -to 00:02:00" "https://www.youtube.com/watch?v=dc7I-i7sPrg"
</pre>
</div>

<p>
Download and convert to best audio format
</p>

<div class="org-src-container">
<pre class="src src-shell">youtube-dl --extract-audio --audio-format mp3 --audio-quality 0 "https://www.youtube.com/watch?v=hAMaCxw9Utw"
</pre>
</div>

<p>
Get the channel ID from a channel URL
</p>

<div class="org-src-container">
<pre class="src src-shell">yt-dlp "https://www.youtube.com/@nicolabizzihistoriae" --print channel_url --playlist-end 1
</pre>
</div>
</div>
</div>
<div id="outline-container-org04eb185" class="outline-4">
<h4 id="org04eb185">Troubleshooting</h4>
<div class="outline-text-4" id="text-org04eb185">
<p>
If you have issues with an error like <code>WARNING: [youtube] Unable to download webpage: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1129)</code>.
</p>

<div class="org-src-container">
<pre class="src src-sh">pip3 install --upgrade certifi
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2024-01-31 Wed 00:00</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 31.0.50 (<a href="https://orgmode.org">Org</a> mode 9.7.11)</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
